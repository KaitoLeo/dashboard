<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Burn Rate Analysis - Actiwell Reports</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <i class="fas fa-chart-line me-2"></i>Actiwell Reports
        </a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="../index.html">
            <i class="fas fa-arrow-left me-1"></i>Quay lại Dashboard
          </a>
        </div>
        <div class="navbar-nav">
          <span class="navbar-text text-white">
            <i class="fas fa-clock me-1"></i>
            <span id="currentTime"></span> |
            <span id="currentDate"></span>
          </span>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <h2 class="text-primary">
            <i class="fas fa-fire me-2"></i>Burn Rate Analysis
          </h2>
          <p class="text-muted">
            Phân tích tần suất sử dụng dịch vụ của hội viên
          </p>
        </div>
      </div>

      <!-- Overview Cards -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Tổng hội viên</h6>
                  <h3 class="mb-0">1,250</h3>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-users fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">High Burn Rate</h6>
                  <h3 class="mb-0">198</h3>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-fire fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Low Burn Rate</h6>
                  <h3 class="mb-0">91</h3>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-exclamation-triangle fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-info text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Avg Burn Rate</h6>
                  <h3 class="mb-0">4.1</h3>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-chart-line fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts -->
      <div class="row mb-4">
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-bar me-2"></i>Phân bố Burn Rate
              </h5>
            </div>
            <div class="card-body">
              <canvas id="burnRateChart" height="100"></canvas>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-line me-2"></i>Xu hướng Burn Rate
              </h5>
            </div>
            <div class="card-body">
              <canvas id="trendChart" height="200"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Facility Analysis -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-building me-2"></i>Phân tích chi tiết theo cơ
                sở
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>STT</th>
                      <th>Cơ sở</th>
                      <th>Avg Burn Rate</th>
                      <th>High Burn Rate</th>
                      <th>Low Burn Rate</th>
                      <th>Silent Members</th>
                      <th>Tổng hội viên</th>
                      <th>Tỉ lệ active</th>
                      <th>Trạng thái</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      style="cursor: pointer"
                      onclick="showLocationDetails('ton-that-thuyet', 'Tôn Thất Thuyết')"
                    >
                      <td>1</td>
                      <td>Tôn Thất Thuyết</td>
                      <td><span class="badge bg-primary">4.5</span></td>
                      <td><span class="badge bg-success">45</span></td>
                      <td><span class="badge bg-warning">12</span></td>
                      <td><span class="badge bg-secondary">3</span></td>
                      <td>250</td>
                      <td>94.0%</td>
                      <td><span class="badge bg-success">Tốt</span></td>
                    </tr>
                    <tr
                      style="cursor: pointer"
                      onclick="showLocationDetails('huynh-thuc-khang', 'Huỳnh Thúc Kháng')"
                    >
                      <td>2</td>
                      <td>Huỳnh Thúc Kháng</td>
                      <td><span class="badge bg-primary">4.8</span></td>
                      <td><span class="badge bg-success">52</span></td>
                      <td><span class="badge bg-warning">8</span></td>
                      <td><span class="badge bg-secondary">2</span></td>
                      <td>300</td>
                      <td>96.7%</td>
                      <td><span class="badge bg-success">Xuất sắc</span></td>
                    </tr>
                    <tr
                      style="cursor: pointer"
                      onclick="showLocationDetails('giang-vo', 'Giảng Võ')"
                    >
                      <td>3</td>
                      <td>Giảng Võ</td>
                      <td><span class="badge bg-primary">3.9</span></td>
                      <td><span class="badge bg-success">38</span></td>
                      <td><span class="badge bg-warning">15</span></td>
                      <td><span class="badge bg-secondary">5</span></td>
                      <td>280</td>
                      <td>89.3%</td>
                      <td><span class="badge bg-warning">Trung bình</span></td>
                    </tr>
                    <tr
                      style="cursor: pointer"
                      onclick="showLocationDetails('hao-nam', 'Hào Nam')"
                    >
                      <td>4</td>
                      <td>Hào Nam</td>
                      <td><span class="badge bg-primary">4.1</span></td>
                      <td><span class="badge bg-success">42</span></td>
                      <td><span class="badge bg-warning">18</span></td>
                      <td><span class="badge bg-secondary">4</span></td>
                      <td>220</td>
                      <td>92.7%</td>
                      <td><span class="badge bg-success">Tốt</span></td>
                    </tr>
                    <tr
                      style="cursor: pointer"
                      onclick="showLocationDetails('nguyen-tuan', 'Nguyễn Tuân')"
                    >
                      <td>5</td>
                      <td>Nguyễn Tuân</td>
                      <td><span class="badge bg-primary">3.2</span></td>
                      <td><span class="badge bg-success">21</span></td>
                      <td><span class="badge bg-warning">36</span></td>
                      <td><span class="badge bg-secondary">11</span></td>
                      <td>200</td>
                      <td>78.0%</td>
                      <td>
                        <span class="badge bg-danger">Cần cải thiện</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Dynamic Member Details Section -->
      <div class="row mb-4" id="memberDetailsSection" style="display: none">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-users me-2"></i>Chi tiết hội viên theo Burn
                Rate - <span id="selectedLocationName"></span>
              </h5>
            </div>
            <div class="card-body">
              <!-- High Burn Rate Members -->
              <div class="row">
                <div class="col-lg-6 mb-4">
                  <div
                    class="d-flex justify-content-between align-items-center mb-2"
                  >
                    <h6 class="text-success mb-0">
                      High Burn Rate Members (>6 lượt/tháng)
                    </h6>
                    <button
                      class="btn btn-outline-success btn-sm"
                      onclick="toggleTable('highBurnRate')"
                    >
                      <i class="fas fa-chevron-down" id="highBurnRateIcon"></i>
                    </button>
                  </div>
                  <div
                    class="table-responsive"
                    id="highBurnRateTable"
                    style="display: none"
                  >
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>Tên</th>
                          <th>Burn Rate</th>
                          <th>Loại thẻ</th>
                          <th>Ngày cuối</th>
                        </tr>
                      </thead>
                      <tbody id="highBurnRateTableBody"></tbody>
                    </table>
                  </div>
                </div>

                <div class="col-lg-6 mb-4">
                  <div
                    class="d-flex justify-content-between align-items-center mb-2"
                  >
                    <h6 class="text-warning mb-0">
                      Low Burn Rate Members (<2 lượt/tháng)
                    </h6>
                    <button
                      class="btn btn-outline-warning btn-sm"
                      onclick="toggleTable('lowBurnRate')"
                    >
                      <i class="fas fa-chevron-down" id="lowBurnRateIcon"></i>
                    </button>
                  </div>
                  <div
                    class="table-responsive"
                    id="lowBurnRateTable"
                    style="display: none"
                  >
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>Tên</th>
                          <th>Burn Rate</th>
                          <th>Loại thẻ</th>
                          <th>Ngày cuối</th>
                        </tr>
                      </thead>
                      <tbody id="lowBurnRateTableBody"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recommendations -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-lightbulb me-2"></i>Khuyến nghị hành động
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-lg-6">
                  <h6 class="text-success">Cho High Burn Rate Members:</h6>
                  <ul>
                    <li>Ưu đãi đặc biệt cho việc duy trì tần suất cao</li>
                    <li>Chương trình loyalty points</li>
                    <li>Mời tham gia các lớp premium</li>
                    <li>Referral program với phần thưởng hấp dẫn</li>
                  </ul>
                </div>
                <div class="col-lg-6">
                  <h6 class="text-warning">Cho Low Burn Rate Members:</h6>
                  <ul>
                    <li>Liên hệ trực tiếp để tìm hiểu nguyên nhân</li>
                    <li>Gửi lịch tập phù hợp với thời gian rảnh</li>
                    <li>Mời tham gia các sự kiện đặc biệt</li>
                    <li>Hỗ trợ cá nhân hóa chương trình tập</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Sample data for each location
      const locationDetails = {
        "ton-that-thuyet": {
          highBurnRate: [
            {
              name: "Nguyễn Văn A",
              burnRate: 8.5,
              cardType: "VIP",
              lastVisit: "15/09/2025",
            },
            {
              name: "Trần Thị B",
              burnRate: 7.2,
              cardType: "Premium",
              lastVisit: "14/09/2025",
            },
            {
              name: "Lê Văn C",
              burnRate: 6.8,
              cardType: "Basic",
              lastVisit: "13/09/2025",
            },
            {
              name: "Phạm Thị D",
              burnRate: 6.5,
              cardType: "Premium",
              lastVisit: "12/09/2025",
            },
            {
              name: "Hoàng Văn E",
              burnRate: 6.1,
              cardType: "VIP",
              lastVisit: "11/09/2025",
            },
          ],
          lowBurnRate: [
            {
              name: "Vũ Thị F",
              burnRate: 1.2,
              cardType: "Basic",
              lastVisit: "20/08/2025",
            },
            {
              name: "Đặng Văn G",
              burnRate: 1.5,
              cardType: "Premium",
              lastVisit: "18/08/2025",
            },
            {
              name: "Bùi Thị H",
              burnRate: 1.8,
              cardType: "Basic",
              lastVisit: "15/08/2025",
            },
          ],
        },
        "huynh-thuc-khang": {
          highBurnRate: [
            {
              name: "Nguyễn Văn A",
              burnRate: 8.5,
              cardType: "VIP",
              lastVisit: "15/09/2025",
            },
            {
              name: "Trần Thị B",
              burnRate: 7.2,
              cardType: "Premium",
              lastVisit: "14/09/2025",
            },
            {
              name: "Lê Văn C",
              burnRate: 6.8,
              cardType: "Basic",
              lastVisit: "13/09/2025",
            },
            {
              name: "Phạm Thị D",
              burnRate: 6.5,
              cardType: "Premium",
              lastVisit: "12/09/2025",
            },
            {
              name: "Hoàng Văn E",
              burnRate: 6.1,
              cardType: "VIP",
              lastVisit: "11/09/2025",
            },
            {
              name: "Ngô Thị K",
              burnRate: 6.3,
              cardType: "Premium",
              lastVisit: "10/09/2025",
            },
          ],
          lowBurnRate: [
            {
              name: "Vũ Thị F",
              burnRate: 1.2,
              cardType: "Basic",
              lastVisit: "20/08/2025",
            },
            {
              name: "Đặng Văn G",
              burnRate: 1.5,
              cardType: "Premium",
              lastVisit: "18/08/2025",
            },
          ],
        },
        "giang-vo": {
          highBurnRate: [
            {
              name: "Nguyễn Văn A",
              burnRate: 8.5,
              cardType: "VIP",
              lastVisit: "15/09/2025",
            },
            {
              name: "Trần Thị B",
              burnRate: 7.2,
              cardType: "Premium",
              lastVisit: "14/09/2025",
            },
            {
              name: "Lê Văn C",
              burnRate: 6.8,
              cardType: "Basic",
              lastVisit: "13/09/2025",
            },
          ],
          lowBurnRate: [
            {
              name: "Vũ Thị F",
              burnRate: 1.2,
              cardType: "Basic",
              lastVisit: "20/08/2025",
            },
            {
              name: "Đặng Văn G",
              burnRate: 1.5,
              cardType: "Premium",
              lastVisit: "18/08/2025",
            },
            {
              name: "Bùi Thị H",
              burnRate: 1.8,
              cardType: "Basic",
              lastVisit: "15/08/2025",
            },
            {
              name: "Phan Văn I",
              burnRate: 1.3,
              cardType: "VIP",
              lastVisit: "12/08/2025",
            },
          ],
        },
        "hao-nam": {
          highBurnRate: [
            {
              name: "Nguyễn Văn A",
              burnRate: 8.5,
              cardType: "VIP",
              lastVisit: "15/09/2025",
            },
            {
              name: "Trần Thị B",
              burnRate: 7.2,
              cardType: "Premium",
              lastVisit: "14/09/2025",
            },
            {
              name: "Lê Văn C",
              burnRate: 6.8,
              cardType: "Basic",
              lastVisit: "13/09/2025",
            },
            {
              name: "Phạm Thị D",
              burnRate: 6.5,
              cardType: "Premium",
              lastVisit: "12/09/2025",
            },
          ],
          lowBurnRate: [
            {
              name: "Vũ Thị F",
              burnRate: 1.2,
              cardType: "Basic",
              lastVisit: "20/08/2025",
            },
            {
              name: "Đặng Văn G",
              burnRate: 1.5,
              cardType: "Premium",
              lastVisit: "18/08/2025",
            },
            {
              name: "Bùi Thị H",
              burnRate: 1.8,
              cardType: "Basic",
              lastVisit: "15/08/2025",
            },
            {
              name: "Phan Văn I",
              burnRate: 1.3,
              cardType: "VIP",
              lastVisit: "12/08/2025",
            },
            {
              name: "Ngô Thị K",
              burnRate: 1.6,
              cardType: "Premium",
              lastVisit: "10/08/2025",
            },
          ],
        },
        "nguyen-tuan": {
          highBurnRate: [
            {
              name: "Nguyễn Văn A",
              burnRate: 8.5,
              cardType: "VIP",
              lastVisit: "15/09/2025",
            },
            {
              name: "Trần Thị B",
              burnRate: 7.2,
              cardType: "Premium",
              lastVisit: "14/09/2025",
            },
          ],
          lowBurnRate: [
            {
              name: "Vũ Thị F",
              burnRate: 1.2,
              cardType: "Basic",
              lastVisit: "20/08/2025",
            },
            {
              name: "Đặng Văn G",
              burnRate: 1.5,
              cardType: "Premium",
              lastVisit: "18/08/2025",
            },
            {
              name: "Bùi Thị H",
              burnRate: 1.8,
              cardType: "Basic",
              lastVisit: "15/08/2025",
            },
            {
              name: "Phan Văn I",
              burnRate: 1.3,
              cardType: "VIP",
              lastVisit: "12/08/2025",
            },
            {
              name: "Ngô Thị K",
              burnRate: 1.6,
              cardType: "Premium",
              lastVisit: "10/08/2025",
            },
            {
              name: "Lê Thị L",
              burnRate: 1.4,
              cardType: "Basic",
              lastVisit: "08/08/2025",
            },
          ],
        },
      };

      // Show location details
      function showLocationDetails(locationId, locationName) {
        document.getElementById("selectedLocationName").textContent =
          locationName;
        document.getElementById("memberDetailsSection").style.display = "block";

        // Populate high burn rate table
        const highBurnRateTableBody = document.getElementById(
          "highBurnRateTableBody"
        );
        highBurnRateTableBody.innerHTML = "";

        if (
          locationDetails[locationId] &&
          locationDetails[locationId].highBurnRate
        ) {
          locationDetails[locationId].highBurnRate.forEach((member) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${member.name}</td>
              <td><span class="badge bg-success">${member.burnRate}</span></td>
              <td>${member.cardType}</td>
              <td>${member.lastVisit}</td>
            `;
            highBurnRateTableBody.appendChild(row);
          });
        }

        // Populate low burn rate table
        const lowBurnRateTableBody = document.getElementById(
          "lowBurnRateTableBody"
        );
        lowBurnRateTableBody.innerHTML = "";

        if (
          locationDetails[locationId] &&
          locationDetails[locationId].lowBurnRate
        ) {
          locationDetails[locationId].lowBurnRate.forEach((member) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${member.name}</td>
              <td><span class="badge bg-warning">${member.burnRate}</span></td>
              <td>${member.cardType}</td>
              <td>${member.lastVisit}</td>
            `;
            lowBurnRateTableBody.appendChild(row);
          });
        }

        // Scroll to details section
        document
          .getElementById("memberDetailsSection")
          .scrollIntoView({ behavior: "smooth" });
      }

      // Toggle table visibility
      function toggleTable(tableType) {
        const table = document.getElementById(tableType + "Table");
        const icon = document.getElementById(tableType + "Icon");

        if (table.style.display === "none") {
          table.style.display = "block";
          icon.className = "fas fa-chevron-up";
        } else {
          table.style.display = "none";
          icon.className = "fas fa-chevron-down";
        }
      }

      // Initialize charts
      function initializeCharts() {
        // Burn Rate Distribution Chart
        const burnRateCtx = document
          .getElementById("burnRateChart")
          .getContext("2d");
        new Chart(burnRateCtx, {
          type: "bar",
          data: {
            labels: [
              "0-1 lượt",
              "1-2 lượt",
              "2-4 lượt",
              "4-6 lượt",
              "6-8 lượt",
              "8+ lượt",
            ],
            datasets: [
              {
                label: "Số lượng hội viên",
                data: [15, 76, 234, 456, 289, 180],
                backgroundColor: [
                  "#dc3545",
                  "#fd7e14",
                  "#ffc107",
                  "#198754",
                  "#0d6efd",
                  "#6f42c1",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });

        // Trend Chart
        const trendCtx = document.getElementById("trendChart").getContext("2d");
        new Chart(trendCtx, {
          type: "line",
          data: {
            labels: [
              "T1",
              "T2",
              "T3",
              "T4",
              "T5",
              "T6",
              "T7",
              "T8",
              "T9",
              "T10",
              "T11",
              "T12",
            ],
            datasets: [
              {
                label: "Avg Burn Rate",
                data: [
                  3.8, 4.1, 3.9, 4.2, 4.0, 4.3, 4.1, 4.0, 4.1, 4.2, 4.0, 4.1,
                ],
                borderColor: "#0d6efd",
                backgroundColor: "rgba(13, 110, 253, 0.1)",
                tension: 0.4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 5,
              },
            },
          },
        });
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        initializeCharts();

        // Update time
        function updateTime() {
          const now = new Date();
          document.getElementById("currentTime").textContent =
            now.toLocaleTimeString("vi-VN");
          document.getElementById("currentDate").textContent =
            now.toLocaleDateString("vi-VN");
        }

        updateTime();
        setInterval(updateTime, 1000);
      });
    </script>
  
    <!-- SPA System -->
    <script src="../assets/js/spa/store.js"></script>
    <script src="../assets/js/spa/components.js"></script>
    <script src="../assets/js/spa/router.js"></script>
    <script src="../assets/js/spa/integration.js"></script>

    <!-- Universal Page Initializer -->
    <script src="../assets/js/shared/page-initializer.js"></script>
  </body>
</html>
