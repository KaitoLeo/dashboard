<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Check-in Hôm Nay - Actiwell Reports</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
    <!-- Checkin Calculation Modules -->
    <script src="../assets/js/checkin/checkin-calculations.js"></script>
    <script src="../assets/js/checkin/checkin-mock-data.js"></script>
    <script src="../assets/js/api/api-client.js"></script>
    <script src="../assets/js/api/api-services.js"></script>
    <script src="../assets/js/api/data-adapter.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <i class="fas fa-chart-line me-2"></i>Actiwell Reports
        </a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="../index.html">
            <i class="fas fa-arrow-left me-1"></i>Quay lại Dashboard
          </a>
        </div>
        <div class="navbar-nav">
          <span class="navbar-text text-white">
            <i class="fas fa-clock me-1"></i>
            <span id="currentTime"></span> |
            <span id="currentDate"></span>
          </span>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <h2 class="text-info">
            <i class="fas fa-calendar-day me-2"></i>Check-in Hôm nay
          </h2>
          <p class="text-muted">Thống kê chi tiết các lượt check-in Hôm nay</p>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <!-- Total Check-in Today Card -->
        <div class="col mb-3">
          <div class="card border-0 shadow-sm bg-info-subtle">
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-chart-line text-info fs-4 me-2"></i>
                <h6 class="mb-0 text-info">Check-in</h6>
              </div>
              <h4 class="text-info mb-0" id="totalCheckinToday">350</h4>
              <small class="text-muted">lượt Hôm nay</small>
            </div>
          </div>
        </div>
        <!-- Membership Check-ins -->
        <div class="col mb-3">
          <div
            class="card border-0 shadow-sm clickable bg-success-subtle"
            onclick="openMembershipCheckinDetail()"
          >
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-id-card text-success fs-4 me-2"></i>
                <h6 class="mb-0 text-success">Membership Check-ins</h6>
              </div>
              <h4 class="text-success mb-0">245</h4>
              <small class="text-muted">lượt Hôm nay</small>
            </div>
          </div>
        </div>
        <!-- PT Fitness Check-ins -->
        <div class="col mb-3">
          <div
            class="card border-0 shadow-sm clickable bg-warning-subtle"
            onclick="openPTFitnessTodayDetail()"
          >
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-dumbbell text-warning fs-4 me-2"></i>
                <h6 class="mb-0">PT Fitness Check-ins</h6>
              </div>
              <h4 class="text-warning mb-0">45</h4>
              <small class="text-muted">lượt Hôm nay</small>
            </div>
          </div>
        </div>
        <!-- Pilates Check-in -->
        <div class="col mb-3">
          <div
            class="card border-0 shadow-sm clickable bg-pink-subtle"
            onclick="openPilatesCheckinDetail()"
          >
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-dumbbell text-pink fs-4 me-2"></i>
                <h6 class="mb-0">Pilates Check-in</h6>
              </div>
              <h4 class="text-pink mb-0">28</h4>
              <small class="text-muted">lượt Hôm nay</small>
            </div>
          </div>
        </div>
        <!-- Swimming Coach Check-in -->
        <div class="col mb-3">
          <div
            class="card border-0 shadow-sm clickable bg-primary-subtle"
            onclick="openSwimmingCoachDetail()"
          >
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-swimmer text-primary fs-4 me-2"></i>
                <h6 class="mb-0 text-primary">Swimming Coach Check-in</h6>
              </div>
              <h4 class="text-primary mb-0">32</h4>
              <small class="text-muted">lượt Hôm nay</small>
            </div>
          </div>
        </div>
        <!-- Check-in sai giờ -->
        <div class="col mb-3">
          <div
            class="card border-0 shadow-sm clickable bg-danger-subtle"
            onclick="openLateCheckinDetail()"
          >
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i
                  class="fas fa-exclamation-triangle text-danger fs-4 me-2"
                ></i>
                <h6 class="mb-0">Check-in sai giờ</h6>
              </div>
              <h4 class="text-danger mb-0">47</h4>
              <small class="text-muted">lượt Hôm nay</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="row mb-4">
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-pie me-2"></i>Phân bố check-in theo bộ
                phận Hôm nay
              </h5>
            </div>
            <div class="card-body">
              <div style="height: 400px">
                <canvas id="checkinTypeChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-pie me-2"></i>Phân bổ check-in theo cơ sở
                Hôm nay
              </h5>
            </div>
            <div class="card-body">
              <div style="height: 400px">
                <canvas id="checkinLocationChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Hourly Trend Chart -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-line me-2"></i>Xu hướng check-in theo giờ
                Hôm nay
              </h5>
            </div>
            <div class="card-body">
              <div style="height: 400px">
                <canvas id="hourlyCheckinChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Check-in Analysis by Location -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-table me-2"></i>Phân tích check-in theo cơ sở
                Hôm nay
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>STT</th>
                      <th>Cơ sở</th>
                      <th>Membership</th>
                      <th>PT Fitness</th>
                      <th>Swimming Coach</th>
                      <th>Pilates</th>
                      <th>Tổng lượt</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>1</td>
                      <td><strong>Tôn Thất Thuyết</strong></td>
                      <td><span class="badge bg-success">65</span></td>
                      <td><span class="badge bg-warning">12</span></td>
                      <td><span class="badge bg-primary">8</span></td>
                      <td><span class="badge bg-pink">6</span></td>
                      <td><span class="text-primary">91</span></td>
                    </tr>
                    <tr>
                      <td>2</td>
                      <td><strong>Huỳnh Thúc Kháng</strong></td>
                      <td><span class="badge bg-success">55</span></td>
                      <td><span class="badge bg-warning">15</span></td>
                      <td><span class="badge bg-primary">12</span></td>
                      <td><span class="badge bg-pink">8</span></td>
                      <td><span class="text-success">90</span></td>
                    </tr>
                    <tr>
                      <td>3</td>
                      <td><strong>Giảng Võ</strong></td>
                      <td><span class="badge bg-success">45</span></td>
                      <td><span class="badge bg-warning">8</span></td>
                      <td><span class="badge bg-primary">6</span></td>
                      <td><span class="badge bg-pink">4</span></td>
                      <td><span class="text-warning">63</span></td>
                    </tr>
                    <tr>
                      <td>4</td>
                      <td><strong>Hào Nam</strong></td>
                      <td><span class="badge bg-success">50</span></td>
                      <td><span class="badge bg-warning">10</span></td>
                      <td><span class="badge bg-primary">9</span></td>
                      <td><span class="badge bg-pink">7</span></td>
                      <td><span class="text-primary">76</span></td>
                    </tr>
                    <tr>
                      <td>5</td>
                      <td><strong>Nguyễn Tuân</strong></td>
                      <td><span class="badge bg-success">30</span></td>
                      <td><span class="badge bg-warning">6</span></td>
                      <td><span class="badge bg-primary">4</span></td>
                      <td><span class="badge bg-pink">3</span></td>
                      <td><span class="text-danger">43</span></td>
                    </tr>
                    <!-- Tổng dọc -->
                    <tr class="table-dark fw-bold">
                      <td colspan="2"><strong>TỔNG CỘNG</strong></td>
                      <td><span class="badge bg-success">245</span></td>
                      <td><span class="badge bg-warning">45</span></td>
                      <td><span class="badge bg-primary">32</span></td>
                      <td><span class="badge bg-pink">28</span></td>
                      <td><span class="text-white fs-5">350</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Time-based Analysis -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-clock me-2"></i>Phân tích theo thời gian Hôm
                nay
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-12">
                  <h6 class="text-primary">Giờ cao điểm check-in Hôm nay</h6>
                  <div class="table-responsive">
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>Khung giờ</th>
                          <th>Số lượt</th>
                          <th>Tỉ lệ</th>
                          <th>Loại chính</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>5:30 - 8:00</td>
                          <td><span class="badge bg-primary">95</span></td>
                          <td><span class="text-success">20.8%</span></td>
                          <td>Membership + Pilates</td>
                        </tr>
                        <tr>
                          <td>8:00 - 10:00</td>
                          <td><span class="badge bg-primary">52</span></td>
                          <td><span class="text-info">11.4%</span></td>
                          <td>Membership</td>
                        </tr>
                        <tr>
                          <td>10:00 - 12:00</td>
                          <td><span class="badge bg-primary">45</span></td>
                          <td><span class="text-info">9.9%</span></td>
                          <td>PT Fitness</td>
                        </tr>
                        <tr>
                          <td>12:00 - 14:00</td>
                          <td><span class="badge bg-primary">58</span></td>
                          <td><span class="text-warning">12.7%</span></td>
                          <td>Membership + PT Fitness</td>
                        </tr>
                        <tr>
                          <td>14:00 - 16:00</td>
                          <td><span class="badge bg-primary">32</span></td>
                          <td><span class="text-muted">7.0%</span></td>
                          <td>Swimming Coach</td>
                        </tr>
                        <tr>
                          <td>16:00 - 18:00</td>
                          <td><span class="badge bg-primary">105</span></td>
                          <td><span class="text-success">23.1%</span></td>
                          <td>Membership + PT Fitness</td>
                        </tr>
                        <tr>
                          <td>18:00 - 20:00</td>
                          <td><span class="badge bg-primary">88</span></td>
                          <td><span class="text-success">19.3%</span></td>
                          <td>Pilates + Swimming Coach</td>
                        </tr>
                        <tr>
                          <td>20:00 - 22:00</td>
                          <td><span class="badge bg-primary">47</span></td>
                          <td><span class="text-warning">10.3%</span></td>
                          <td>Check-in sai giờ</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recommendations -->
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/realtime-clock.js"></script>
    <script>
      // Check-in Type Chart
      const checkinTypeCtx = document
        .getElementById("checkinTypeChart")
        .getContext("2d");
      new Chart(checkinTypeCtx, {
        type: "doughnut",
        data: {
          labels: ["Membership", "PT Fitness", "Pilates", "Swimming Coach"],
          datasets: [
            {
              data: [245, 45, 28, 32],
              backgroundColor: ["#198754", "#ffc107", "#e83e8c", "#0d6efd"],
              borderWidth: 2,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: "Phân bố check-in theo loại Hôm nay",
            },
            legend: {
              position: "bottom",
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  const label = context.label || "";
                  const value = context.parsed;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${label}: ${value} lượt (${percentage}%)`;
                },
              },
            },
          },
        },
      });

      // Check-in Location Chart
      const checkinLocationCtx = document
        .getElementById("checkinLocationChart")
        .getContext("2d");
      new Chart(checkinLocationCtx, {
        type: "doughnut",
        data: {
          labels: [
            "Tôn Thất Thuyết",
            "Huỳnh Thúc Kháng",
            "Giảng Võ",
            "Hào Nam",
            "Nguyễn Tuân",
          ],
          datasets: [
            {
              data: [77, 95, 65, 71, 42],
              backgroundColor: [
                "#0d6efd",
                "#28a745",
                "#ffc107",
                "#17a2b8",
                "#6f42c1",
              ],
              borderWidth: 2,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: "Phân bổ check-in theo cơ sở Hôm nay",
            },
            legend: {
              position: "bottom",
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  const label = context.label || "";
                  const value = context.parsed;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${label}: ${value} lượt (${percentage}%)`;
                },
              },
            },
          },
        },
      });

      // Hourly Check-in Chart
      const hourlyCheckinCtx = document
        .getElementById("hourlyCheckinChart")
        .getContext("2d");
      new Chart(hourlyCheckinCtx, {
        type: "line",
        data: {
          labels: [
            "5:00",
            "6:00",
            "7:00",
            "8:00",
            "9:00",
            "10:00",
            "11:00",
            "12:00",
            "13:00",
            "14:00",
            "15:00",
            "16:00",
            "17:00",
            "18:00",
            "19:00",
            "20:00",
            "21:00",
            "22:00",
          ],
          datasets: [
            {
              label: "Membership",
              data: [
                5, 18, 28, 38, 25, 22, 26, 30, 25, 18, 22, 25, 50, 55, 35, 18,
                10, 3,
              ],
              borderColor: "#198754",
              backgroundColor: "rgba(25, 135, 84, 0.1)",
              tension: 0.4,
            },
            {
              label: "PT Fitness",
              data: [
                2, 10, 15, 18, 10, 8, 10, 12, 8, 5, 8, 10, 18, 22, 15, 8, 4, 1,
              ],
              borderColor: "#ffc107",
              backgroundColor: "rgba(255, 193, 7, 0.1)",
              tension: 0.4,
            },
            {
              label: "Pilates",
              data: [1, 6, 10, 12, 8, 5, 6, 8, 5, 4, 5, 6, 10, 12, 10, 5, 3, 0],
              borderColor: "#e83e8c",
              backgroundColor: "rgba(232, 62, 140, 0.1)",
              tension: 0.4,
            },
            {
              label: "Swimming Coach",
              data: [0, 4, 6, 10, 5, 4, 5, 6, 4, 3, 4, 5, 8, 10, 8, 4, 2, 0],
              borderColor: "#0d6efd",
              backgroundColor: "rgba(13, 110, 253, 0.1)",
              tension: 0.4,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: "Xu hướng check-in theo giờ Hôm nay",
            },
          },
          scales: {
            y: {
              beginAtZero: true,
            },
          },
        },
      });

      // Metric card click handlers
      function openSwimmingCoachDetail() {
        window.location.href = "03-01-06-02-swimming-checkin-today-detail.html";
      }

      function openPilatesCheckinDetail() {
        window.location.href = "03-01-05-02-pilates-checkin-today-detail.html";
      }

      function openPTFitnessTodayDetail() {
        window.location.href =
          "03-01-04-02-pt-fitness-checkin-today-detail.html";
      }

      function openMembershipCheckinDetail() {
        window.location.href =
          "03-01-02-02-membership-checkin-today-detail.html";
      }

      function openLateCheckinDetail() {
        window.location.href = "03-01-07-02-late-checkin-today-detail.html";
      }

      // Update total check-in today
      function updateTotalCheckinToday() {
        if (window.ConsistentData) {
          const todayData = window.ConsistentData.getData("today", "all");
          const totalCheckin =
            todayData.membershipCheckin +
            todayData.ptFitnessCheckin +
            todayData.pilatesCheckin +
            todayData.swimmingCoachCheckin;

          const totalElement = document.getElementById("totalCheckinToday");
          if (totalElement) {
            totalElement.textContent = totalCheckin.toLocaleString();
          }
        } else {
          // Fallback to hardcoded values
          const membershipCheckin = 245;
          const ptFitnessCheckin = 45;
          const pilatesCheckin = 28;
          const swimmingCoachCheckin = 32;

          const totalCheckin =
            membershipCheckin +
            ptFitnessCheckin +
            pilatesCheckin +
            swimmingCoachCheckin;

          const totalElement = document.getElementById("totalCheckinToday");
          if (totalElement) {
            totalElement.textContent = totalCheckin.toLocaleString();
          }
        }
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        updateTotalCheckinToday();
      });
    </script>
    <!-- Filter Integration Script -->
    <script src="../assets/js/data-consistency.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/filter-handler.js"></script>
  
    <!-- Universal Page Initializer -->
    <script src="../assets/js/shared/page-initializer.js"></script>
  </body>
</html>
