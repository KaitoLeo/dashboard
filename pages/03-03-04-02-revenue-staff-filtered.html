<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Báo cáo doanh số theo nhân viên bán hàng - Actiwell Reports</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />
  
    <!-- Revenue Calculation Modules -->
    <script src="../assets/js/revenue/revenue-calculations.js"></script>
    <script src="../assets/js/revenue/revenue-mock-data.js"></script>
    <!-- API Layer -->
    <script src="../assets/js/api/api-client.js"></script>
    <script src="../assets/js/api/api-services.js"></script>
    <script src="../assets/js/api/data-adapter.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <i class="fas fa-arrow-left me-2"></i>
          <i class="fas fa-heartbeat me-2"></i>
          Actiwell Reports
        </a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <h2 class="card-title">
                <i class="fas fa-user-tie me-2"></i>
                Báo cáo doanh số theo nhân viên bán hàng
              </h2>
              <p class="text-muted">
                Báo cáo chi tiết doanh số theo từng nhân viên với phân loại
                DE/PIF/PB
              </p>
              <div class="alert alert-info">
                <h6>
                  <i class="fas fa-info-circle me-2"></i>Ghi chú về phân loại
                  doanh số:
                </h6>
                <ul class="mb-0">
                  <li>
                    <strong>DE (Deposit):</strong> Doanh số đặt cọc - không vào
                    dữ liệu doanh số tính lương
                  </li>
                  <li>
                    <strong>PIF (Pay in Full):</strong> Doanh số thu đủ - vào dữ
                    liệu doanh số tính lương
                  </li>
                  <li>
                    <strong>PB (Pay Balance):</strong> Doanh số thu nợ - vào dữ
                    liệu doanh số tính lương
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-filter me-2"></i>
                Điều kiện lọc
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <!-- Thời gian -->
                <div class="col-md-3 mb-3">
                  <label class="form-label">Thời gian:</label>
                  <select class="form-select" id="timeFilter">
                    <option value="date">Từ ngày/đến ngày</option>
                    <option value="month">Tháng</option>
                    <option value="quarter">Quý</option>
                    <option value="year">Năm</option>
                  </select>
                </div>
                <div class="col-md-2 mb-3" id="fromDateDiv">
                  <label class="form-label">Từ ngày:</label>
                  <input
                    type="date"
                    class="form-control"
                    id="fromDate"
                    value="2024-12-01"
                  />
                </div>
                <div class="col-md-2 mb-3" id="toDateDiv">
                  <label class="form-label">Đến ngày:</label>
                  <input
                    type="date"
                    class="form-control"
                    id="toDate"
                    value="2024-12-15"
                  />
                </div>
                <div class="col-md-2 mb-3" id="monthDiv" style="display: none">
                  <label class="form-label">Tháng:</label>
                  <select class="form-select" id="monthSelect">
                    <option value="1">Tháng 1</option>
                    <option value="2">Tháng 2</option>
                    <option value="3">Tháng 3</option>
                    <option value="4">Tháng 4</option>
                    <option value="5">Tháng 5</option>
                    <option value="6">Tháng 6</option>
                    <option value="7">Tháng 7</option>
                    <option value="8">Tháng 8</option>
                    <option value="9">Tháng 9</option>
                    <option value="10">Tháng 10</option>
                    <option value="11">Tháng 11</option>
                    <option value="12" selected>Tháng 12</option>
                  </select>
                </div>
                <div
                  class="col-md-2 mb-3"
                  id="quarterDiv"
                  style="display: none"
                >
                  <label class="form-label">Quý:</label>
                  <select class="form-select" id="quarterSelect">
                    <option value="1">Quý 1</option>
                    <option value="2">Quý 2</option>
                    <option value="3">Quý 3</option>
                    <option value="4" selected>Quý 4</option>
                  </select>
                </div>
                <div class="col-md-2 mb-3" id="yearDiv" style="display: none">
                  <label class="form-label">Năm:</label>
                  <select class="form-select" id="yearSelect">
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024" selected>2024</option>
                  </select>
                </div>
                <div class="col-md-1 mb-3">
                  <label class="form-label">&nbsp;</label>
                  <button
                    class="btn btn-primary w-100"
                    onclick="applyFilters()"
                  >
                    <i class="fas fa-search me-1"></i>Lọc
                  </button>
                </div>
              </div>
              <div class="row">
                <!-- Mã nhân viên -->
                <div class="col-md-3 mb-3">
                  <label class="form-label">Mã nhân viên:</label>
                  <select class="form-select" id="staffFilter">
                    <option value="all">Tất cả nhân viên</option>
                    <option value="NV001">NV001 - Nguyễn Văn A</option>
                    <option value="NV002">NV002 - Trần Thị B</option>
                    <option value="NV003">NV003 - Lê Văn C</option>
                    <option value="NV004">NV004 - Phạm Thị D</option>
                    <option value="NV005">NV005 - Hoàng Văn E</option>
                    <option value="NV006">NV006 - Vũ Thị F</option>
                    <option value="NV007">NV007 - Đặng Văn G</option>
                    <option value="NV008">NV008 - Bùi Thị H</option>
                  </select>
                </div>
                <!-- CLB -->
                <div class="col-md-3 mb-3">
                  <label class="form-label">CLB:</label>
                  <select class="form-select" id="clubFilter">
                    <option value="all">Tất cả CLB</option>
                    <option value="1">Tôn Thất Thuyết</option>
                    <option value="2">Huỳnh Thúc Kháng</option>
                    <option value="3">Giảng Võ</option>
                    <option value="4">Hào Nam</option>
                    <option value="5">Nguyễn Tuân</option>
                  </select>
                </div>
                <!-- Bộ phận -->
                <div class="col-md-3 mb-3">
                  <label class="form-label">Bộ phận:</label>
                  <select class="form-select" id="departmentFilter">
                    <option value="all">Tất cả bộ phận</option>
                    <option value="membership">Membership</option>
                    <option value="fitness">Fitness</option>
                    <option value="pool">Pool</option>
                    <option value="pilates">Pilates</option>
                    <option value="operation">Operation</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">&nbsp;</label>
                  <div class="d-flex gap-2">
                    <button class="btn btn-success" onclick="exportReport()">
                      <i class="fas fa-download me-1"></i>Xuất Excel
                    </button>
                    <button class="btn btn-info" onclick="printReport()">
                      <i class="fas fa-print me-1"></i>In
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Tổng doanh số</h6>
                  <h3 class="mb-0" id="totalRevenue">0</h3>
                  <small>VNĐ</small>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-money-bill-wave fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Đặt cọc [DE]</h6>
                  <h3 class="mb-0" id="totalDE">0</h3>
                  <small>VNĐ</small>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-hand-holding-usd fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Doanh số tính lương</h6>
                  <h3 class="mb-0" id="totalSalary">0</h3>
                  <small>VNĐ (PIF + PB)</small>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-calculator fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-info text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Nhân viên xuất sắc</h6>
                  <h5 class="mb-0" id="topStaff">-</h5>
                  <small>nhân viên</small>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-trophy fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Revenue by Staff Table -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-chart-bar me-2"></i>
                Chi tiết doanh số theo nhân viên bán hàng
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table
                  id="revenueTable"
                  class="table table-striped table-hover"
                >
                  <thead class="table-dark">
                    <tr>
                      <th>STT</th>
                      <th>Mã NV</th>
                      <th>Tên nhân viên</th>
                      <th>CLB</th>
                      <th>Đặt cọc [DE] (VNĐ)</th>
                      <th>Thu đủ [PIF] (VNĐ)</th>
                      <th>Thu nợ [PB] (VNĐ)</th>
                      <th>Tổng doanh số (VNĐ)</th>
                      <th>Doanh số tính lương (VNĐ)</th>
                      <th>Số HĐ</th>
                      <th>TB/HĐ (VNĐ)</th>
                      <th>Xếp hạng</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>1</td>
                      <td><strong>NV001</strong></td>
                      <td><strong>Nguyễn Văn A</strong></td>
                      <td>Tôn Thất Thuyết</td>
                      <td><span class="text-warning">45,000,000</span></td>
                      <td><span class="text-success">180,000,000</span></td>
                      <td><span class="text-info">75,000,000</span></td>
                      <td><strong class="text-primary">300,000,000</strong></td>
                      <td><strong class="text-success">255,000,000</strong></td>
                      <td><span class="badge bg-primary">25</span></td>
                      <td><strong class="text-info">12,000,000</strong></td>
                      <td><span class="badge bg-warning">#1</span></td>
                    </tr>
                    <tr>
                      <td>2</td>
                      <td><strong>NV002</strong></td>
                      <td><strong>Trần Thị B</strong></td>
                      <td>Huỳnh Thúc Kháng</td>
                      <td><span class="text-warning">38,000,000</span></td>
                      <td><span class="text-success">165,000,000</span></td>
                      <td><span class="text-info">67,000,000</span></td>
                      <td><strong class="text-primary">270,000,000</strong></td>
                      <td><strong class="text-success">232,000,000</strong></td>
                      <td><span class="badge bg-primary">22</span></td>
                      <td><strong class="text-info">12,272,727</strong></td>
                      <td><span class="badge bg-warning">#2</span></td>
                    </tr>
                    <tr>
                      <td>3</td>
                      <td><strong>NV003</strong></td>
                      <td><strong>Lê Văn C</strong></td>
                      <td>Giảng Võ</td>
                      <td><span class="text-warning">42,000,000</span></td>
                      <td><span class="text-success">155,000,000</span></td>
                      <td><span class="text-info">63,000,000</span></td>
                      <td><strong class="text-primary">260,000,000</strong></td>
                      <td><strong class="text-success">218,000,000</strong></td>
                      <td><span class="badge bg-primary">20</span></td>
                      <td><strong class="text-info">13,000,000</strong></td>
                      <td><span class="badge bg-warning">#3</span></td>
                    </tr>
                    <tr>
                      <td>4</td>
                      <td><strong>NV004</strong></td>
                      <td><strong>Phạm Thị D</strong></td>
                      <td>Hào Nam</td>
                      <td><span class="text-warning">35,000,000</span></td>
                      <td><span class="text-success">140,000,000</span></td>
                      <td><span class="text-info">55,000,000</span></td>
                      <td><strong class="text-primary">230,000,000</strong></td>
                      <td><strong class="text-success">195,000,000</strong></td>
                      <td><span class="badge bg-primary">18</span></td>
                      <td><strong class="text-info">12,777,778</strong></td>
                      <td><span class="badge bg-warning">#4</span></td>
                    </tr>
                    <tr>
                      <td>5</td>
                      <td><strong>NV005</strong></td>
                      <td><strong>Hoàng Văn E</strong></td>
                      <td>Nguyễn Tuân</td>
                      <td><span class="text-warning">32,000,000</span></td>
                      <td><span class="text-success">125,000,000</span></td>
                      <td><span class="text-info">48,000,000</span></td>
                      <td><strong class="text-primary">205,000,000</strong></td>
                      <td><strong class="text-success">173,000,000</strong></td>
                      <td><span class="badge bg-primary">16</span></td>
                      <td><strong class="text-info">12,812,500</strong></td>
                      <td><span class="badge bg-warning">#5</span></td>
                    </tr>
                    <tr>
                      <td>6</td>
                      <td><strong>NV006</strong></td>
                      <td><strong>Vũ Thị F</strong></td>
                      <td></td>
                      <td><span class="text-warning">28,000,000</span></td>
                      <td><span class="text-success">110,000,000</span></td>
                      <td><span class="text-info">42,000,000</span></td>
                      <td><strong class="text-primary">180,000,000</strong></td>
                      <td><strong class="text-success">152,000,000</strong></td>
                      <td><span class="badge bg-primary">14</span></td>
                      <td><strong class="text-info">12,857,143</strong></td>
                      <td><span class="badge bg-warning">#6</span></td>
                    </tr>
                    <tr>
                      <td>7</td>
                      <td><strong>NV007</strong></td>
                      <td><strong>Đặng Văn G</strong></td>
                      <td></td>
                      <td><span class="text-warning">25,000,000</span></td>
                      <td><span class="text-success">95,000,000</span></td>
                      <td><span class="text-info">35,000,000</span></td>
                      <td><strong class="text-primary">155,000,000</strong></td>
                      <td><strong class="text-success">130,000,000</strong></td>
                      <td><span class="badge bg-primary">12</span></td>
                      <td><strong class="text-info">12,916,667</strong></td>
                      <td><span class="badge bg-warning">#7</span></td>
                    </tr>
                    <tr>
                      <td>8</td>
                      <td><strong>NV008</strong></td>
                      <td><strong>Bùi Thị H</strong></td>
                      <td></td>
                      <td><span class="text-warning">22,000,000</span></td>
                      <td><span class="text-success">85,000,000</span></td>
                      <td><span class="text-info">28,000,000</span></td>
                      <td><strong class="text-primary">135,000,000</strong></td>
                      <td><strong class="text-success">113,000,000</strong></td>
                      <td><span class="badge bg-primary">10</span></td>
                      <td><strong class="text-info">13,500,000</strong></td>
                      <td><span class="badge bg-warning">#8</span></td>
                    </tr>
                  </tbody>
                  <tfoot class="table-dark">
                    <tr>
                      <td><strong>TỔNG CỘNG</strong></td>
                      <td><strong>-</strong></td>
                      <td><strong>8 nhân viên</strong></td>
                      <td><strong>-</strong></td>
                      <td><strong class="text-warning">267,000,000</strong></td>
                      <td>
                        <strong class="text-success">1,055,000,000</strong>
                      </td>
                      <td><strong class="text-info">412,000,000</strong></td>
                      <td>
                        <strong class="text-primary">1,735,000,000</strong>
                      </td>
                      <td>
                        <strong class="text-success">1,467,000,000</strong>
                      </td>
                      <td><strong>137</strong></td>
                      <td><strong class="text-info">12,664,234</strong></td>
                      <td><strong>-</strong></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart Section -->
      <div class="row mb-4">
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-chart-pie me-2"></i>
                Biểu đồ phân bố doanh số theo nhân viên
              </h5>
            </div>
            <div class="card-body">
              <canvas id="revenueChart" height="300"></canvas>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-chart-bar me-2"></i>
                Biểu đồ cột doanh số tính lương (PIF + PB)
              </h5>
            </div>
            <div class="card-body">
              <canvas id="salaryChart" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../assets/js/main.js"></script>
    <script>
      // Sample data
      const staffData = {
        staff: [
          {
            code: "NV001",
            name: "Nguyễn Văn A",
            club: "Tôn Thất Thuyết",
            de: 45000000,
            pif: 180000000,
            pb: 75000000,
            total: 300000000,
            salary: 255000000,
            contracts: 25,
            avg: 12000000,
          },
          {
            code: "NV002",
            name: "Trần Thị B",
            club: "Huỳnh Thúc Kháng",
            de: 38000000,
            pif: 165000000,
            pb: 67000000,
            total: 270000000,
            salary: 232000000,
            contracts: 22,
            avg: 12272727,
          },
          {
            code: "NV003",
            name: "Lê Văn C",
            club: "Giảng Võ",
            de: 42000000,
            pif: 155000000,
            pb: 63000000,
            total: 260000000,
            salary: 218000000,
            contracts: 20,
            avg: 13000000,
          },
          {
            code: "NV004",
            name: "Phạm Thị D",
            club: "Hào Nam",
            de: 35000000,
            pif: 140000000,
            pb: 55000000,
            total: 230000000,
            salary: 195000000,
            contracts: 18,
            avg: 12777778,
          },
          {
            code: "NV005",
            name: "Hoàng Văn E",
            club: "Nguyễn Tuân",
            de: 32000000,
            pif: 125000000,
            pb: 48000000,
            total: 205000000,
            salary: 173000000,
            contracts: 16,
            avg: 12812500,
          },
          {
            code: "NV006",
            name: "Vũ Thị F",
            de: 28000000,
            pif: 110000000,
            pb: 42000000,
            total: 180000000,
            salary: 152000000,
            contracts: 14,
            avg: 12857143,
          },
          {
            code: "NV007",
            name: "Đặng Văn G",
            de: 25000000,
            pif: 95000000,
            pb: 35000000,
            total: 155000000,
            salary: 130000000,
            contracts: 12,
            avg: 12916667,
          },
          {
            code: "NV008",
            name: "Bùi Thị H",
            de: 22000000,
            pif: 85000000,
            pb: 28000000,
            total: 135000000,
            salary: 113000000,
            contracts: 10,
            avg: 13500000,
          },
        ],
      };

      // Time filter change handler
      document
        .getElementById("timeFilter")
        .addEventListener("change", function () {
          const timeType = this.value;
          document.getElementById("fromDateDiv").style.display =
            timeType === "date" ? "block" : "none";
          document.getElementById("toDateDiv").style.display =
            timeType === "date" ? "block" : "none";
          document.getElementById("monthDiv").style.display =
            timeType === "month" ? "block" : "none";
          document.getElementById("quarterDiv").style.display =
            timeType === "quarter" ? "block" : "none";
          document.getElementById("yearDiv").style.display =
            timeType === "year" ? "block" : "none";
        });

      function applyFilters() {
        const timeFilter = document.getElementById("timeFilter").value;
        const fromDate = document.getElementById("fromDate").value;
        const toDate = document.getElementById("toDate").value;
        const month = document.getElementById("monthSelect").value;
        const quarter = document.getElementById("quarterSelect").value;
        const year = document.getElementById("yearSelect").value;
        const staffFilter = document.getElementById("staffFilter").value;
        const clubFilter = document.getElementById("clubFilter").value;
        const departmentFilter =
          document.getElementById("departmentFilter").value;

        console.log("Filtering by:", {
          timeFilter,
          fromDate,
          toDate,
          month,
          quarter,
          year,
          staffFilter,
          clubFilter,
          departmentFilter,
        });

        // Filter logic
        filterTable(staffFilter, clubFilter, departmentFilter);
        updateSummaryCards();

        alert(
          `Đã áp dụng bộ lọc:\n- Thời gian: ${getTimeDisplay()}\n- Nhân viên: ${getStaffDisplay()}\n- CLB: ${getClubDisplay()}\n- Bộ phận: ${getDepartmentDisplay()}`
        );
      }

      function getTimeDisplay() {
        const timeFilter = document.getElementById("timeFilter").value;
        switch (timeFilter) {
          case "date":
            return `${document.getElementById("fromDate").value} - ${
              document.getElementById("toDate").value
            }`;
          case "month":
            return `Tháng ${document.getElementById("monthSelect").value}`;
          case "quarter":
            return `Quý ${document.getElementById("quarterSelect").value}`;
          case "year":
            return `Năm ${document.getElementById("yearSelect").value}`;
          default:
            return "Tất cả";
        }
      }

      function getStaffDisplay() {
        const staff = document.getElementById("staffFilter").value;
        return staff === "all" ? "Tất cả nhân viên" : staff;
      }

      function getClubDisplay() {
        const club = document.getElementById("clubFilter").value;
        const clubNames = [
          "",
          "Tôn Thất Thuyết",
          "Huỳnh Thúc Kháng",
          "Giảng Võ",
          "Hào Nam",
          "Nguyễn Tuân",
          "",
          "",
          "",
          "",
          "",
        ];
        return club === "all" ? "Tất cả CLB" : clubNames[parseInt(club)];
      }

      function getDepartmentDisplay() {
        const dept = document.getElementById("departmentFilter").value;
        const deptNames = {
          all: "Tất cả bộ phận",
          membership: "Membership",
          fitness: "Fitness",
          pool: "Pool",
          pilates: "Pilates",
          operation: "Operation",
        };
        return deptNames[dept];
      }

      function filterTable(staffFilter, clubFilter, departmentFilter) {
        const rows = document.querySelectorAll("#revenueTable tbody tr");
        rows.forEach((row, index) => {
          let showRow = true;

          // Filter by staff
          if (staffFilter !== "all") {
            const staffCode = row.cells[1].textContent.trim();
            if (staffCode !== staffFilter) {
              showRow = false;
            }
          }

          row.style.display = showRow ? "" : "none";
        });
      }

      function updateSummaryCards() {
        // Calculate totals from visible rows
        const visibleRows = document.querySelectorAll(
          '#revenueTable tbody tr:not([style*="display: none"])'
        );
        let totalRevenue = 0;
        let totalDE = 0;
        let totalSalary = 0;
        let topStaff = "";
        let topRevenue = 0;

        visibleRows.forEach((row) => {
          const revenue = parseInt(
            row.cells[7].textContent.replace(/[^\d]/g, "")
          );
          const de = parseInt(row.cells[4].textContent.replace(/[^\d]/g, ""));
          const salary = parseInt(
            row.cells[8].textContent.replace(/[^\d]/g, "")
          );
          const staffName = row.cells[2].textContent.trim();

          totalRevenue += revenue;
          totalDE += de;
          totalSalary += salary;

          if (revenue > topRevenue) {
            topRevenue = revenue;
            topStaff = staffName;
          }
        });

        // Update cards
        document.getElementById("totalRevenue").textContent =
          totalRevenue.toLocaleString("vi-VN");
        document.getElementById("totalDE").textContent =
          totalDE.toLocaleString("vi-VN");
        document.getElementById("totalSalary").textContent =
          totalSalary.toLocaleString("vi-VN");
        document.getElementById("topStaff").textContent = topStaff;
      }

      function exportReport() {
        const timeDisplay = getTimeDisplay();
        const staffDisplay = getStaffDisplay();
        const clubDisplay = getClubDisplay();
        const departmentDisplay = getDepartmentDisplay();

        alert(
          `Xuất báo cáo Excel:\n- Thời gian: ${timeDisplay}\n- Nhân viên: ${staffDisplay}\n- CLB: ${clubDisplay}\n- Bộ phận: ${departmentDisplay}`
        );
      }

      function printReport() {
        window.print();
      }

      // Initialize charts
      document.addEventListener("DOMContentLoaded", function () {
        // Pie Chart - Total Revenue
        const ctx1 = document.getElementById("revenueChart").getContext("2d");
        new Chart(ctx1, {
          type: "pie",
          data: {
            labels: staffData.staff.map((staff) => staff.name),
            datasets: [
              {
                data: staffData.staff.map((staff) => staff.total),
                backgroundColor: [
                  "#FF6384",
                  "#36A2EB",
                  "#FFCE56",
                  "#4BC0C0",
                  "#9966FF",
                  "#FF9F40",
                  "#FF6384",
                  "#C9CBCF",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const total = context.dataset.data.reduce(
                      (a, b) => a + b,
                      0
                    );
                    const percentage = ((context.parsed / total) * 100).toFixed(
                      1
                    );
                    return context.label + ": " + percentage + "%";
                  },
                },
              },
            },
          },
        });

        // Bar Chart - Salary Revenue (PIF + PB)
        const ctx2 = document.getElementById("salaryChart").getContext("2d");
        new Chart(ctx2, {
          type: "bar",
          data: {
            labels: staffData.staff.map((staff) => staff.name),
            datasets: [
              {
                label: "Doanh số tính lương (VNĐ)",
                data: staffData.staff.map((staff) => staff.salary),
                backgroundColor: "#36A2EB",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value.toLocaleString("vi-VN") + " VNĐ";
                  },
                },
              },
            },
          },
        });

        // Initialize summary cards
        updateSummaryCards();
      });
    </script>
  
    <!-- SPA System -->
    <script src="../assets/js/spa/store.js"></script>
    <script src="../assets/js/spa/components.js"></script>
    <script src="../assets/js/spa/router.js"></script>
    <script src="../assets/js/spa/integration.js"></script>

    <!-- Universal Page Initializer -->
    <script src="../assets/js/shared/page-initializer.js"></script>
  </body>
</html>
