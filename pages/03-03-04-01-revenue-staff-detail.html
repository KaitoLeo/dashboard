<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Báo cáo doanh số theo nhân viên - Actiwell Reports</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />

    <!-- Revenue Calculation Modules -->
    <script src="../assets/js/revenue/revenue-calculations.js"></script>
    <script src="../assets/js/revenue/revenue-mock-data.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <i class="fas fa-arrow-left me-2"></i>
          <i class="fas fa-heartbeat me-2"></i>
          Actiwell Reports
        </a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <h2 class="card-title">
                <i class="fas fa-users me-2"></i>
                Báo cáo doanh số theo nhân viên bán hàng
              </h2>
              <p class="text-muted">
                Thống kê chi tiết doanh số của từng nhân viên bán hàng
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-primary text-white">
            <div class="card-body text-center">
              <h5 class="card-title">Tổng doanh số</h5>
              <h2 class="mb-0">2,850,000,000</h2>
              <small>VNĐ</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-success text-white">
            <div class="card-body text-center">
              <h5 class="card-title">Số nhân viên</h5>
              <h2 class="mb-0">25</h2>
              <small>người</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-info text-white">
            <div class="card-body text-center">
              <h5 class="card-title">Trung bình/NV</h5>
              <h2 class="mb-0">114,000,000</h2>
              <small>VNĐ</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-warning text-white">
            <div class="card-body text-center">
              <h5 class="card-title">Top performer</h5>
              <h2 class="mb-0">350,000,000</h2>
              <small>Nguyễn Văn A</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Staff Performance Table -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-chart-bar me-2"></i>
                Bảng xếp hạng nhân viên bán hàng
              </h5>
              <div class="alert alert-info mt-2">
                <strong>Ghi chú:</strong>
                <ul class="mb-0 mt-2">
                  <li>
                    <strong>DE (Đặt cọc):</strong> Doanh số treo, không vào dữ
                    liệu doanh số tính lương
                  </li>
                  <li>
                    <strong>PIF (Thu đủ) + PB (Thu nợ):</strong> Doanh số vào dữ
                    liệu doanh số tính lương
                  </li>
                  <li><strong>Doanh số tính lương = PIF + PB</strong></li>
                </ul>
              </div>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>#</th>
                      <th>Mã NV</th>
                      <th>Tên nhân viên</th>
                      <th>CLB</th>
                      <th>Đặt cọc [DE] (VNĐ)</th>
                      <th>Thu đủ [PIF] (VNĐ)</th>
                      <th>Thu nợ [PB] (VNĐ)</th>
                      <th>Tổng doanh số (VNĐ)</th>
                      <th>Doanh số tính lương (VNĐ)</th>
                      <th>Số HĐ</th>
                      <th>TB/HĐ (VNĐ)</th>
                      <th>Đánh giá</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><span class="badge bg-warning">1</span></td>
                      <td>NV001</td>
                      <td><strong>Nguyễn Văn A</strong></td>
                      <td>Tôn Thất Thuyết</td>
                      <td>50,000,000</td>
                      <td>200,000,000</td>
                      <td>100,000,000</td>
                      <td><strong>350,000,000</strong></td>
                      <td><strong class="text-success">300,000,000</strong></td>
                      <td>25</td>
                      <td>14,000,000</td>
                      <td><span class="badge bg-success">Xuất sắc</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">2</span></td>
                      <td>NV002</td>
                      <td><strong>Trần Thị B</strong></td>
                      <td>Huỳnh Thúc Kháng</td>
                      <td>30,000,000</td>
                      <td>180,000,000</td>
                      <td>80,000,000</td>
                      <td><strong>290,000,000</strong></td>
                      <td><strong class="text-success">260,000,000</strong></td>
                      <td>20</td>
                      <td>14,500,000</td>
                      <td><span class="badge bg-success">Tốt</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">3</span></td>
                      <td>NV003</td>
                      <td><strong>Lê Văn C</strong></td>
                      <td>Giảng Võ</td>
                      <td>40,000,000</td>
                      <td>150,000,000</td>
                      <td>60,000,000</td>
                      <td><strong>250,000,000</strong></td>
                      <td><strong class="text-success">210,000,000</strong></td>
                      <td>18</td>
                      <td>13,888,889</td>
                      <td><span class="badge bg-success">Tốt</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">4</span></td>
                      <td>NV004</td>
                      <td><strong>Phạm Thị D</strong></td>
                      <td>Hào Nam</td>
                      <td>35,000,000</td>
                      <td>140,000,000</td>
                      <td>50,000,000</td>
                      <td><strong>225,000,000</strong></td>
                      <td><strong class="text-success">190,000,000</strong></td>
                      <td>16</td>
                      <td>14,062,500</td>
                      <td><span class="badge bg-warning">Khá</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">5</span></td>
                      <td>NV005</td>
                      <td><strong>Hoàng Văn E</strong></td>
                      <td>Nguyễn Tuân</td>
                      <td>25,000,000</td>
                      <td>120,000,000</td>
                      <td>40,000,000</td>
                      <td><strong>185,000,000</strong></td>
                      <td><strong class="text-success">160,000,000</strong></td>
                      <td>14</td>
                      <td>13,214,286</td>
                      <td><span class="badge bg-warning">Khá</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">6</span></td>
                      <td>NV006</td>
                      <td><strong>Vũ Thị F</strong></td>
                      <td>Tôn Thất Thuyết</td>
                      <td>20,000,000</td>
                      <td>100,000,000</td>
                      <td>35,000,000</td>
                      <td><strong>155,000,000</strong></td>
                      <td><strong class="text-success">135,000,000</strong></td>
                      <td>12</td>
                      <td>12,916,667</td>
                      <td><span class="badge bg-warning">Khá</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">7</span></td>
                      <td>NV007</td>
                      <td><strong>Đặng Văn G</strong></td>
                      <td>Hào Nam</td>
                      <td>15,000,000</td>
                      <td>90,000,000</td>
                      <td>30,000,000</td>
                      <td><strong>135,000,000</strong></td>
                      <td><strong class="text-success">120,000,000</strong></td>
                      <td>11</td>
                      <td>12,272,727</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">8</span></td>
                      <td>NV008</td>
                      <td><strong>Bùi Thị H</strong></td>
                      <td>Giảng Võ</td>
                      <td>18,000,000</td>
                      <td>95,000,000</td>
                      <td>32,000,000</td>
                      <td><strong>145,000,000</strong></td>
                      <td><strong class="text-success">127,000,000</strong></td>
                      <td>13</td>
                      <td>11,153,846</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">9</span></td>
                      <td>NV009</td>
                      <td><strong>Ngô Văn I</strong></td>
                      <td>Huỳnh Thúc Kháng</td>
                      <td>12,000,000</td>
                      <td>80,000,000</td>
                      <td>28,000,000</td>
                      <td><strong>120,000,000</strong></td>
                      <td><strong class="text-success">108,000,000</strong></td>
                      <td>10</td>
                      <td>12,000,000</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">10</span></td>
                      <td>NV010</td>
                      <td><strong>Lý Thị K</strong></td>
                      <td>Nguyễn Tuân</td>
                      <td>8,000,000</td>
                      <td>70,000,000</td>
                      <td>25,000,000</td>
                      <td><strong>103,000,000</strong></td>
                      <td><strong class="text-success">95,000,000</strong></td>
                      <td>9</td>
                      <td>11,444,444</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">11</span></td>
                      <td>NV011</td>
                      <td><strong>Hồ Văn L</strong></td>
                      <td>Tôn Thất Thuyết</td>
                      <td>22,000,000</td>
                      <td>110,000,000</td>
                      <td>45,000,000</td>
                      <td><strong>177,000,000</strong></td>
                      <td><strong class="text-success">155,000,000</strong></td>
                      <td>15</td>
                      <td>11,800,000</td>
                      <td><span class="badge bg-warning">Khá</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">12</span></td>
                      <td>NV012</td>
                      <td><strong>Phan Thị M</strong></td>
                      <td>Hào Nam</td>
                      <td>16,000,000</td>
                      <td>85,000,000</td>
                      <td>30,000,000</td>
                      <td><strong>131,000,000</strong></td>
                      <td><strong class="text-success">115,000,000</strong></td>
                      <td>12</td>
                      <td>10,916,667</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">13</span></td>
                      <td>NV013</td>
                      <td><strong>Trịnh Văn N</strong></td>
                      <td>Giảng Võ</td>
                      <td>10,000,000</td>
                      <td>75,000,000</td>
                      <td>22,000,000</td>
                      <td><strong>107,000,000</strong></td>
                      <td><strong class="text-success">97,000,000</strong></td>
                      <td>10</td>
                      <td>10,700,000</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">14</span></td>
                      <td>NV014</td>
                      <td><strong>Đinh Thị O</strong></td>
                      <td>Huỳnh Thúc Kháng</td>
                      <td>14,000,000</td>
                      <td>78,000,000</td>
                      <td>26,000,000</td>
                      <td><strong>118,000,000</strong></td>
                      <td><strong class="text-success">104,000,000</strong></td>
                      <td>11</td>
                      <td>10,727,273</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">15</span></td>
                      <td>NV015</td>
                      <td><strong>Võ Văn P</strong></td>
                      <td>Nguyễn Tuân</td>
                      <td>6,000,000</td>
                      <td>65,000,000</td>
                      <td>20,000,000</td>
                      <td><strong>91,000,000</strong></td>
                      <td><strong class="text-success">85,000,000</strong></td>
                      <td>8</td>
                      <td>11,375,000</td>
                      <td><span class="badge bg-danger">Yếu</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">16</span></td>
                      <td>NV016</td>
                      <td><strong>Lê Thị Q</strong></td>
                      <td>Tôn Thất Thuyết</td>
                      <td>19,000,000</td>
                      <td>88,000,000</td>
                      <td>33,000,000</td>
                      <td><strong>140,000,000</strong></td>
                      <td><strong class="text-success">121,000,000</strong></td>
                      <td>13</td>
                      <td>10,769,231</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">17</span></td>
                      <td>NV017</td>
                      <td><strong>Nguyễn Văn R</strong></td>
                      <td>Hào Nam</td>
                      <td>11,000,000</td>
                      <td>72,000,000</td>
                      <td>24,000,000</td>
                      <td><strong>107,000,000</strong></td>
                      <td><strong class="text-success">96,000,000</strong></td>
                      <td>10</td>
                      <td>10,700,000</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">18</span></td>
                      <td>NV018</td>
                      <td><strong>Trần Thị S</strong></td>
                      <td>Giảng Võ</td>
                      <td>13,000,000</td>
                      <td>82,000,000</td>
                      <td>29,000,000</td>
                      <td><strong>124,000,000</strong></td>
                      <td><strong class="text-success">111,000,000</strong></td>
                      <td>11</td>
                      <td>11,272,727</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">19</span></td>
                      <td>NV019</td>
                      <td><strong>Phạm Văn T</strong></td>
                      <td>Huỳnh Thúc Kháng</td>
                      <td>9,000,000</td>
                      <td>68,000,000</td>
                      <td>21,000,000</td>
                      <td><strong>98,000,000</strong></td>
                      <td><strong class="text-success">89,000,000</strong></td>
                      <td>9</td>
                      <td>10,888,889</td>
                      <td><span class="badge bg-info">Trung bình</span></td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-secondary">20</span></td>
                      <td>NV020</td>
                      <td><strong>Hoàng Thị U</strong></td>
                      <td>Nguyễn Tuân</td>
                      <td>7,000,000</td>
                      <td>60,000,000</td>
                      <td>18,000,000</td>
                      <td><strong>85,000,000</strong></td>
                      <td><strong class="text-success">78,000,000</strong></td>
                      <td>8</td>
                      <td>10,625,000</td>
                      <td><span class="badge bg-danger">Yếu</span></td>
                    </tr>
                  </tbody>
                  <tfoot class="table-dark">
                    <tr>
                      <th colspan="4">TỔNG CỘNG</th>
                      <th>2,850,000,000</th>
                      <th>13,200,000,000</th>
                      <th>5,550,000,000</th>
                      <th><strong>21,600,000,000</strong></th>
                      <th>
                        <strong class="text-success">18,750,000,000</strong>
                      </th>
                      <th>1,080</th>
                      <th>20,000,000</th>
                      <th>-</th>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Charts -->
      <div class="row mb-4">
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-chart-pie me-2"></i>
                Phân bố doanh số theo CLB
              </h5>
            </div>
            <div class="card-body">
              <canvas id="clubRevenueChart" height="300"></canvas>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-chart-bar me-2"></i>
                Top 10 nhân viên xuất sắc
              </h5>
            </div>
            <div class="card-body">
              <canvas id="topStaffChart" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Analysis and Recommendations -->
      <div class="row">
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-trophy me-2"></i>
                Nhân viên xuất sắc
              </h5>
            </div>
            <div class="card-body">
              <div class="list-group">
                <div class="list-group-item">
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">Nguyễn Văn A</h6>
                    <span class="badge bg-warning">1st</span>
                  </div>
                  <p class="mb-1">Doanh số: 350,000,000 VNĐ</p>
                  <small>25 hợp đồng - TB: 14M VNĐ/HĐ</small>
                </div>
                <div class="list-group-item">
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">Trần Thị B</h6>
                    <span class="badge bg-secondary">2nd</span>
                  </div>
                  <p class="mb-1">Doanh số: 290,000,000 VNĐ</p>
                  <small>20 hợp đồng - TB: 14.5M VNĐ/HĐ</small>
                </div>
                <div class="list-group-item">
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">Lê Văn C</h6>
                    <span class="badge bg-secondary">3rd</span>
                  </div>
                  <p class="mb-1">Doanh số: 250,000,000 VNĐ</p>
                  <small>18 hợp đồng - TB: 13.9M VNĐ/HĐ</small>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-lightbulb me-2"></i>
                Khuyến nghị cải thiện
              </h5>
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Nhân rộng kinh nghiệm của Nguyễn Văn A
                </li>
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Đào tạo kỹ năng bán hàng cho nhân viên mới
                </li>
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Tăng cường hỗ trợ cho nhân viên có doanh số thấp
                </li>
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Thiết lập mục tiêu cá nhân phù hợp
                </li>
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Tổ chức cuộc thi bán hàng hàng tháng
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script>
      // Club Revenue Chart
      const clubCtx = document.getElementById("clubRevenueChart");
      if (clubCtx) {
        new Chart(clubCtx, {
          type: "doughnut",
          data: {
            labels: [
              "Tôn Thất Thuyết",
              "Huỳnh Thúc Kháng",
              "Giảng Võ",
              "Hào Nam",
              "Nguyễn Tuân",
            ],
            datasets: [
              {
                data: [35, 29, 25, 22.5, 18.5],
                backgroundColor: [
                  "rgba(40, 167, 69, 0.8)",
                  "rgba(0, 123, 255, 0.8)",
                  "rgba(23, 162, 184, 0.8)",
                  "rgba(255, 193, 7, 0.8)",
                  "rgba(220, 53, 69, 0.8)",
                ],
                borderColor: [
                  "rgba(40, 167, 69, 1)",
                  "rgba(0, 123, 255, 1)",
                  "rgba(23, 162, 184, 1)",
                  "rgba(255, 193, 7, 1)",
                  "rgba(220, 53, 69, 1)",
                ],
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: "Tỉ trọng doanh số theo CLB (%)",
              },
              legend: {
                position: "bottom",
              },
            },
          },
        });
      }

      // Top Staff Chart
      const staffCtx = document.getElementById("topStaffChart");
      if (staffCtx) {
        new Chart(staffCtx, {
          type: "bar",
          data: {
            labels: [
              "Nguyễn Văn A",
              "Trần Thị B",
              "Lê Văn C",
              "Phạm Thị D",
              "Hoàng Văn E",
            ],
            datasets: [
              {
                label: "Doanh số (VNĐ)",
                data: [350, 290, 250, 225, 185],
                backgroundColor: [
                  "rgba(40, 167, 69, 0.8)",
                  "rgba(0, 123, 255, 0.8)",
                  "rgba(23, 162, 184, 0.8)",
                  "rgba(255, 193, 7, 0.8)",
                  "rgba(220, 53, 69, 0.8)",
                ],
                borderColor: [
                  "rgba(40, 167, 69, 1)",
                  "rgba(0, 123, 255, 1)",
                  "rgba(23, 162, 184, 1)",
                  "rgba(255, 193, 7, 1)",
                  "rgba(220, 53, 69, 1)",
                ],
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: "Top 5 nhân viên xuất sắc (Triệu VNĐ)",
              },
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value + "M";
                  },
                },
              },
            },
          },
        });
      }
    </script>

    <!-- Dynamic Staff Revenue Calculations -->
    <script>
      /**
       * Revenue by Staff - Dynamic Calculations
       */
      window.addEventListener("load", function () {
        if (
          typeof window.revenueCalc !== "undefined" &&
          typeof window.currentMonthRevenue !== "undefined"
        ) {
          console.log(
            "👥 Initializing Revenue by Staff with dynamic calculations..."
          );
          calculateStaffRevenue();
        } else {
          console.warn("⚠️ Revenue modules not loaded for staff page");
        }
      });

      function calculateStaffRevenue() {
        try {
          const currentRevenue = window.currentMonthRevenue;

          // Calculate revenue by staff
          const revenueByStaff =
            window.revenueCalc.calculateRevenueByStaff(currentRevenue);

          console.log("✅ Revenue by Staff calculated:");
          Object.keys(revenueByStaff).forEach((staff) => {
            const data = revenueByStaff[staff];
            console.log(`   ${staff}:`);
            console.log(
              `      Total: ${window.revenueCalc.formatCurrency(
                data.totalRevenue
              )} VNĐ`
            );
            console.log(`      Transactions: ${data.transactions}`);
            console.log(
              `      Average: ${window.revenueCalc.formatCurrency(
                data.avgTransaction
              )} VNĐ/transaction`
            );
          });
        } catch (error) {
          console.error("❌ Error calculating staff revenue:", error);
        }
      }
    </script>

    <!-- SPA System -->
    <script src="../assets/js/spa/store.js"></script>
    <script src="../assets/js/spa/components.js"></script>
    <script src="../assets/js/spa/router.js"></script>
    <script src="../assets/js/spa/integration.js"></script>

    <!-- Universal Page Initializer -->
    <script src="../assets/js/shared/page-initializer.js"></script>
  </body>
</html>
