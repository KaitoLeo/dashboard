<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi tiết Hội viên Sinh nhật</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../assets/css/style.css" />
  </head>
  <body>
    <div class="container-fluid">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h2 class="mb-1">Chi tiết Hội viên Sinh nhật</h2>
              <p class="text-muted mb-0">
                Danh sách hội viên có sinh nhật theo tháng
              </p>
            </div>
            <div>
              <button class="btn btn-outline-secondary me-2" onclick="goBack()">
                <i class="fas fa-arrow-left me-1"></i>Quay lại
              </button>
              <button class="btn btn-primary">
                <i class="fas fa-download me-1"></i>Xuất báo cáo
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Bộ lọc</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-lg-3 col-md-6 mb-3">
                  <label class="form-label">Tháng</label>
                  <select
                    class="form-select"
                    id="monthFilter"
                    onchange="filterBirthdayMembers()"
                  >
                    <option value="current">Tháng này</option>
                    <option value="next">Tháng sau</option>
                    <option value="previous">Tháng trước</option>
                    <option value="all">Tất cả</option>
                  </select>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                  <label class="form-label">CLB</label>
                  <select
                    class="form-select"
                    id="clubFilter"
                    onchange="filterBirthdayMembers()"
                  >
                    <option value="all">Tất cả CLB</option>
                    <option value="huynh-thuc-khang">
                      CLB Huỳnh Thúc Kháng
                    </option>
                    <option value="nguyen-tuan">CLB Nguyễn Tuân</option>
                    <option value="giang-vo">CLB Giảng Võ</option>
                  </select>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                  <label class="form-label">Trạng thái</label>
                  <select
                    class="form-select"
                    id="statusFilter"
                    onchange="filterBirthdayMembers()"
                  >
                    <option value="all">Tất cả</option>
                    <option value="active">Đang hoạt động</option>
                    <option value="expired">Hết hạn</option>
                    <option value="suspended">Tạm dừng</option>
                  </select>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                  <label class="form-label">Tìm kiếm</label>
                  <input
                    type="text"
                    class="form-control"
                    id="searchInput"
                    placeholder="Tên hội viên..."
                    onkeyup="filterBirthdayMembers()"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- KPI Cards -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-birthday-cake text-warning fs-4 me-2"></i>
                <h6 class="mb-0">Tổng sinh nhật</h6>
              </div>
              <h4 class="text-warning mb-0" id="totalBirthdays">5</h4>
              <small class="text-muted">hội viên</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-calendar-day text-success fs-4 me-2"></i>
                <h6 class="mb-0">Hôm nay</h6>
              </div>
              <h4 class="text-success mb-0" id="todayBirthdays">2</h4>
              <small class="text-muted">hội viên</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-calendar-week text-info fs-4 me-2"></i>
                <h6 class="mb-0">Tuần này</h6>
              </div>
              <h4 class="text-info mb-0" id="weekBirthdays">3</h4>
              <small class="text-muted">hội viên</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-gift text-primary fs-4 me-2"></i>
                <h6 class="mb-0">Đã tặng quà</h6>
              </div>
              <h4 class="text-primary mb-0" id="giftedCount">1</h4>
              <small class="text-muted">hội viên</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Birthday Members Table -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-table me-2"></i>Danh sách Hội viên Sinh nhật
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover" id="birthdayTable">
                  <thead class="table-light">
                    <tr>
                      <th>Hội viên</th>
                      <th class="text-center">Ngày sinh</th>
                      <th class="text-center">Tuổi</th>
                      <th class="text-center">CLB</th>
                      <th class="text-center">Trạng thái</th>
                      <th class="text-center">Số điện thoại</th>
                      <th class="text-center">Hành động</th>
                    </tr>
                  </thead>
                  <tbody id="birthdayTableBody">
                    <!-- Data will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Sample data for birthday members
      const birthdayData = {
        current: [
          {
            id: 1,
            name: "Nguyễn Văn An",
            birthday: "15/09/1990",
            age: 34,
            club: "CLB Huỳnh Thúc Kháng",
            status: "active",
            phone: "0901234567",
            gifted: false,
          },
          {
            id: 2,
            name: "Trần Thị Bình",
            birthday: "20/09/1985",
            age: 39,
            club: "CLB Nguyễn Tuân",
            status: "active",
            phone: "0902345678",
            gifted: true,
          },
          {
            id: 3,
            name: "Lê Văn Cường",
            birthday: "25/09/1992",
            age: 32,
            club: "CLB Giảng Võ",
            status: "active",
            phone: "0903456789",
            gifted: false,
          },
          {
            id: 4,
            name: "Phạm Thị Dung",
            birthday: "28/09/1988",
            age: 36,
            club: "CLB Huỳnh Thúc Kháng",
            status: "expired",
            phone: "0904567890",
            gifted: false,
          },
          {
            id: 5,
            name: "Hoàng Văn Em",
            birthday: "30/09/1995",
            age: 29,
            club: "CLB Nguyễn Tuân",
            status: "active",
            phone: "0905678901",
            gifted: false,
          },
        ],
        next: [
          {
            id: 6,
            name: "Vũ Thị Phương",
            birthday: "05/10/1991",
            age: 33,
            club: "CLB Giảng Võ",
            status: "active",
            phone: "0906789012",
            gifted: false,
          },
          {
            id: 7,
            name: "Đặng Văn Giang",
            birthday: "12/10/1987",
            age: 37,
            club: "CLB Huỳnh Thúc Kháng",
            status: "active",
            phone: "0907890123",
            gifted: false,
          },
        ],
        previous: [
          {
            id: 8,
            name: "Bùi Thị Hoa",
            birthday: "10/08/1993",
            age: 31,
            club: "CLB Nguyễn Tuân",
            status: "active",
            phone: "0908901234",
            gifted: true,
          },
          {
            id: 9,
            name: "Ngô Văn Ích",
            birthday: "18/08/1989",
            age: 35,
            club: "CLB Giảng Võ",
            status: "suspended",
            phone: "0909012345",
            gifted: false,
          },
        ],
      };

      function goBack() {
        window.history.back();
      }

      function filterBirthdayMembers() {
        const monthFilter = document.getElementById("monthFilter").value;
        const clubFilter = document.getElementById("clubFilter").value;
        const statusFilter = document.getElementById("statusFilter").value;
        const searchInput = document
          .getElementById("searchInput")
          .value.toLowerCase();

        let filteredData = [];

        // Get data based on month filter
        if (monthFilter === "all") {
          filteredData = [
            ...birthdayData.current,
            ...birthdayData.next,
            ...birthdayData.previous,
          ];
        } else {
          filteredData = birthdayData[monthFilter] || [];
        }

        // Apply club filter
        if (clubFilter !== "all") {
          filteredData = filteredData.filter((member) =>
            member.club.toLowerCase().includes(clubFilter.replace("-", " "))
          );
        }

        // Apply status filter
        if (statusFilter !== "all") {
          filteredData = filteredData.filter(
            (member) => member.status === statusFilter
          );
        }

        // Apply search filter
        if (searchInput) {
          filteredData = filteredData.filter((member) =>
            member.name.toLowerCase().includes(searchInput)
          );
        }

        // Update table
        updateBirthdayTable(filteredData);
        updateKPICards(filteredData);
      }

      function updateBirthdayTable(data) {
        const tbody = document.getElementById("birthdayTableBody");
        tbody.innerHTML = "";

        data.forEach((member) => {
          const row = document.createElement("tr");

          let statusBadge = "";
          let statusClass = "";
          switch (member.status) {
            case "active":
              statusBadge = "Đang hoạt động";
              statusClass = "bg-success";
              break;
            case "expired":
              statusBadge = "Hết hạn";
              statusClass = "bg-danger";
              break;
            case "suspended":
              statusBadge = "Tạm dừng";
              statusClass = "bg-warning";
              break;
          }

          row.innerHTML = `
            <td>
              <div class="d-flex align-items-center">
                <div class="avatar-sm bg-warning text-white rounded-circle d-flex align-items-center justify-content-center me-2">
                  <i class="fas fa-user"></i>
                </div>
                <div>
                  <strong>${member.name}</strong>
                </div>
              </div>
            </td>
            <td class="text-center">${member.birthday}</td>
            <td class="text-center">${member.age}</td>
            <td class="text-center">${member.club}</td>
            <td class="text-center">
              <span class="badge ${statusClass}">${statusBadge}</span>
            </td>
            <td class="text-center">${member.phone}</td>
            <td class="text-center">
              ${
                member.gifted
                  ? '<span class="badge bg-success">Đã tặng</span>'
                  : '<button class="btn btn-sm btn-outline-warning" onclick="sendGift(' +
                    member.id +
                    ')"><i class="fas fa-gift me-1"></i>Tặng quà</button>'
              }
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function updateKPICards(data) {
        document.getElementById("totalBirthdays").textContent = data.length;

        // Calculate today's birthdays (simulate)
        const todayBirthdays = data.filter((member) =>
          member.birthday.includes("15/09")
        ).length;
        document.getElementById("todayBirthdays").textContent = todayBirthdays;

        // Calculate week's birthdays (simulate)
        const weekBirthdays = data.filter(
          (member) =>
            member.birthday.includes("15/09") ||
            member.birthday.includes("20/09") ||
            member.birthday.includes("25/09")
        ).length;
        document.getElementById("weekBirthdays").textContent = weekBirthdays;

        // Calculate gifted count
        const giftedCount = data.filter((member) => member.gifted).length;
        document.getElementById("giftedCount").textContent = giftedCount;
      }

      function sendGift(memberId) {
        if (confirm("Bạn có chắc chắn muốn tặng quà cho hội viên này?")) {
          // Simulate sending gift
          alert("Đã gửi quà tặng thành công!");
          // Update the member's gifted status
          // In real implementation, this would update the database
          filterBirthdayMembers(); // Refresh the table
        }
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        console.log("Birthday members detail page loaded");
        filterBirthdayMembers(); // Load initial data
      });
    </script>
  
    <!-- SPA System -->
    <script src="../assets/js/spa/store.js"></script>
    <script src="../assets/js/spa/components.js"></script>
    <script src="../assets/js/spa/router.js"></script>
    <script src="../assets/js/spa/integration.js"></script>

    <!-- Universal Page Initializer -->
    <script src="../assets/js/shared/page-initializer.js"></script>
  </body>
</html>
