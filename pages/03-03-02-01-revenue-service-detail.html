<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B√°o c√°o doanh s·ªë theo d·ªãch v·ª• - Actiwell Reports</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />

    <!-- Revenue Calculation Modules -->
    <script src="../assets/js/revenue/revenue-calculations.js"></script>
    <script src="../assets/js/revenue/revenue-mock-data.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <i class="fas fa-heartbeat me-2"></i>
          Actiwell Reports
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">
                <i class="fas fa-arrow-left me-1"></i>Quay l·∫°i Dashboard
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h4 class="card-title mb-0">
                <i class="fas fa-cogs me-2"></i>
                B√°o c√°o doanh s·ªë theo d·ªãch v·ª•
              </h4>
              <small class="text-muted">Th√°ng 12/2024</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-primary text-white">
            <div class="card-body text-center">
              <h5 class="card-title">Membership</h5>
              <h2 class="mb-0">1,200,000,000</h2>
              <small>VNƒê (64.9%)</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-success text-white">
            <div class="card-body text-center">
              <h5 class="card-title">Fitness</h5>
              <h2 class="mb-0">450,000,000</h2>
              <small>VNƒê (24.3%)</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-info text-white">
            <div class="card-body text-center">
              <h5 class="card-title">Swimming Coach</h5>
              <h2 class="mb-0">150,000,000</h2>
              <small>VNƒê (8.1%)</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-warning text-white">
            <div class="card-body text-center">
              <h5 class="card-title">Pilates</h5>
              <h2 class="mb-0">50,000,000</h2>
              <small>VNƒê (2.7%)</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="row mb-4">
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Bi·ªÉu ƒë·ªì doanh thu theo d·ªãch v·ª•</h5>
            </div>
            <div class="card-body">
              <canvas id="serviceRevenueChart" height="300"></canvas>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">T·ªâ tr·ªçng doanh thu theo d·ªãch v·ª•</h5>
            </div>
            <div class="card-body">
              <canvas id="serviceShareChart" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Service Details -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                Chi ti·∫øt doanh thu theo g√≥i d·ªãch v·ª•
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>D·ªãch v·ª•</th>
                      <th>G√≥i</th>
                      <th>Doanh thu (VNƒê)</th>
                      <th>T·ªâ tr·ªçng (%)</th>
                      <th>S·ªë h·ª£p ƒë·ªìng</th>
                      <th>Gi√° tr·ªã TB/Hƒê (VNƒê)</th>
                      <th>Tr·∫°ng th√°i</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td rowspan="4"><strong>Membership</strong></td>
                      <td>G√≥i 1 th√°ng</td>
                      <td>600,000,000</td>
                      <td>32.4%</td>
                      <td>1,200</td>
                      <td>500,000</td>
                      <td><span class="badge bg-success">T·ªët</span></td>
                    </tr>
                    <tr>
                      <td>G√≥i 3 th√°ng</td>
                      <td>450,000,000</td>
                      <td>24.3%</td>
                      <td>300</td>
                      <td>1,500,000</td>
                      <td><span class="badge bg-success">T·ªët</span></td>
                    </tr>
                    <tr>
                      <td>G√≥i 6 th√°ng</td>
                      <td>300,000,000</td>
                      <td>16.2%</td>
                      <td>100</td>
                      <td>3,000,000</td>
                      <td><span class="badge bg-warning">Trung b√¨nh</span></td>
                    </tr>
                    <tr>
                      <td>G√≥i 12 th√°ng</td>
                      <td>500,000,000</td>
                      <td>27.0%</td>
                      <td>50</td>
                      <td>10,000,000</td>
                      <td><span class="badge bg-success">T·ªët</span></td>
                    </tr>
                    <tr>
                      <td rowspan="2"><strong>Fitness</strong></td>
                      <td>PT 1-1</td>
                      <td>300,000,000</td>
                      <td>16.2%</td>
                      <td>200</td>
                      <td>1,500,000</td>
                      <td><span class="badge bg-success">T·ªët</span></td>
                    </tr>
                    <tr>
                      <td>Group Class</td>
                      <td>150,000,000</td>
                      <td>8.1%</td>
                      <td>500</td>
                      <td>300,000</td>
                      <td><span class="badge bg-info">·ªîn ƒë·ªãnh</span></td>
                    </tr>
                    <tr>
                      <td><strong>Swimming Coach</strong></td>
                      <td>B∆°i l·ªôi</td>
                      <td>150,000,000</td>
                      <td>8.1%</td>
                      <td>300</td>
                      <td>500,000</td>
                      <td><span class="badge bg-info">·ªîn ƒë·ªãnh</span></td>
                    </tr>
                    <tr>
                      <td><strong>Pilates</strong></td>
                      <td>Pilates</td>
                      <td>50,000,000</td>
                      <td>2.7%</td>
                      <td>100</td>
                      <td>500,000</td>
                      <td>
                        <span class="badge bg-warning">C·∫ßn c·∫£i thi·ªán</span>
                      </td>
                    </tr>
                  </tbody>
                  <tfoot class="table-dark">
                    <tr>
                      <th colspan="2">T·ªîNG C·ªòNG</th>
                      <th>1,850,000,000</th>
                      <th>100%</th>
                      <th>2,750</th>
                      <th>673,000</th>
                      <th>-</th>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Revenue Trend -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                Xu h∆∞·ªõng doanh thu theo d·ªãch v·ª• (6 th√°ng g·∫ßn ƒë√¢y)
              </h5>
            </div>
            <div class="card-body">
              <canvas id="serviceTrendChart" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Analysis -->
      <div class="row">
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Ph√¢n t√≠ch hi·ªáu su·∫•t</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <h6>D·ªãch v·ª• d·∫´n ƒë·∫ßu:</h6>
                <p class="text-success">Membership - 1,200M VNƒê (64.9%)</p>
              </div>
              <div class="mb-3">
                <h6>D·ªãch v·ª• c·∫ßn c·∫£i thi·ªán:</h6>
                <p class="text-warning">Pilates - 50M VNƒê (2.7%)</p>
              </div>
              <div class="mb-3">
                <h6>G√≥i ph·ªï bi·∫øn nh·∫•t:</h6>
                <p class="text-info">G√≥i 1 th√°ng - 1,200 h·ª£p ƒë·ªìng</p>
              </div>
              <div class="mb-3">
                <h6>G√≥i c√≥ gi√° tr·ªã cao nh·∫•t:</h6>
                <p class="text-primary">G√≥i 12 th√°ng - 10M VNƒê/Hƒê</p>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Khuy·∫øn ngh·ªã chi·∫øn l∆∞·ª£c</h5>
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  TƒÉng c∆∞·ªùng marketing cho d·ªãch v·ª• Pilates
                </li>
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Khuy·∫øn kh√≠ch n√¢ng c·∫•p t·ª´ g√≥i 1 th√°ng l√™n 3 th√°ng
                </li>
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Ph√°t tri·ªÉn th√™m g√≥i d·ªãch v·ª• k·∫øt h·ª£p
                </li>
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  T·ªëi ∆∞u h√≥a gi√° c·∫£ cho g√≥i 6 th√°ng
                </li>
                <li class="list-group-item">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  M·ªü r·ªông d·ªãch v·ª• Swimming Coach v√† Fitness
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script>
      // Initialize charts when page loads
      document.addEventListener("DOMContentLoaded", function () {
        // Wait for revenue modules to load
        if (
          typeof window.revenueCalc !== "undefined" &&
          typeof window.currentMonthRevenue !== "undefined"
        ) {
          initializeServiceChartsDynamic();
        } else {
          console.warn("‚ö†Ô∏è Revenue modules not loaded, using static data");
          initializeServiceCharts();
        }
      });

      /**
       * Initialize service charts with dynamic data
       */
      function initializeServiceChartsDynamic() {
        console.log(
          "üí∞ Initializing Revenue by Service with dynamic calculations..."
        );

        try {
          const currentRevenue = window.currentMonthRevenue;
          const services = [
            "Membership",
            "PT Fitness",
            "Pilates",
            "Swimming Coach",
          ];

          // Calculate revenue by service
          const revenueByService = window.revenueCalc.calculateRevenueByService(
            currentRevenue,
            services
          );
          const servicePercentages =
            window.revenueCalc.calculatePercentageDistribution(
              revenueByService
            );

          // Calculate total for verification
          const totalRevenue = Object.values(revenueByService).reduce(
            (sum, amount) => sum + amount,
            0
          );

          console.log("‚úÖ Revenue by Service calculated:");
          services.forEach((service) => {
            console.log(
              `   ${service}: ${window.revenueCalc.formatCurrency(
                revenueByService[service]
              )} VNƒê (${servicePercentages[service].toFixed(1)}%)`
            );
          });

          // Create charts with dynamic data
          createServiceCharts(services, revenueByService, servicePercentages);
        } catch (error) {
          console.error("‚ùå Error calculating service revenue:", error);
          initializeServiceCharts(); // Fallback to static
        }
      }

      /**
       * Create charts with dynamic data
       */
      function createServiceCharts(services, revenueByService, percentages) {
        // Service Revenue Bar Chart
        const ctx1 = document.getElementById("serviceRevenueChart");
        if (ctx1) {
          new Chart(ctx1, {
            type: "bar",
            data: {
              labels: services,
              datasets: [
                {
                  label: "Doanh thu (VNƒê)",
                  data: services.map((s) => revenueByService[s]),
                  backgroundColor: [
                    "rgba(40, 167, 69, 0.8)",
                    "rgba(0, 123, 255, 0.8)",
                    "rgba(23, 162, 184, 0.8)",
                    "rgba(255, 193, 7, 0.8)",
                  ],
                  borderColor: [
                    "rgba(40, 167, 69, 1)",
                    "rgba(0, 123, 255, 1)",
                    "rgba(23, 162, 184, 1)",
                    "rgba(255, 193, 7, 1)",
                  ],
                  borderWidth: 2,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: {
                  display: true,
                  text: "Doanh thu theo d·ªãch v·ª•",
                },
                legend: {
                  display: false,
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return (value / 1000000).toFixed(0) + "M";
                    },
                  },
                },
              },
            },
          });
        }

        // Service Share Pie Chart
        const ctx2 = document.getElementById("serviceShareChart");
        if (ctx2) {
          new Chart(ctx2, {
            type: "doughnut",
            data: {
              labels: services,
              datasets: [
                {
                  data: services.map((s) => percentages[s]),
                  backgroundColor: [
                    "rgba(40, 167, 69, 0.8)",
                    "rgba(0, 123, 255, 0.8)",
                    "rgba(23, 162, 184, 0.8)",
                    "rgba(255, 193, 7, 0.8)",
                  ],
                  borderColor: [
                    "rgba(40, 167, 69, 1)",
                    "rgba(0, 123, 255, 1)",
                    "rgba(23, 162, 184, 1)",
                    "rgba(255, 193, 7, 1)",
                  ],
                  borderWidth: 2,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: {
                  display: true,
                  text: "T·ªâ tr·ªçng doanh thu theo d·ªãch v·ª• (%)",
                },
                legend: {
                  position: "bottom",
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      return context.label + ": " + context.parsed + " l∆∞·ª£t";
                    },
                  },
                },
              },
            },
          });
        }

        // Service Trend Line Chart
        const ctx3 = document.getElementById("serviceTrendChart");
        if (ctx3) {
          new Chart(ctx3, {
            type: "line",
            data: {
              labels: [
                "Th√°ng 7",
                "Th√°ng 8",
                "Th√°ng 9",
                "Th√°ng 10",
                "Th√°ng 11",
                "Th√°ng 12",
              ],
              datasets: [
                {
                  label: "Membership",
                  data: [
                    1100000000, 1150000000, 1200000000, 1180000000, 1220000000,
                    1200000000,
                  ],
                  borderColor: "rgba(40, 167, 69, 1)",
                  backgroundColor: "rgba(40, 167, 69, 0.1)",
                  tension: 0.3,
                },
                {
                  label: "Fitness",
                  data: [
                    400000000, 420000000, 430000000, 440000000, 450000000,
                    450000000,
                  ],
                  borderColor: "rgba(0, 123, 255, 1)",
                  backgroundColor: "rgba(0, 123, 255, 0.1)",
                  tension: 0.3,
                },
                {
                  label: "Swimming Coach",
                  data: [
                    140000000, 145000000, 150000000, 148000000, 152000000,
                    150000000,
                  ],
                  borderColor: "rgba(23, 162, 184, 1)",
                  backgroundColor: "rgba(23, 162, 184, 0.1)",
                  tension: 0.3,
                },
                {
                  label: "Pilates",
                  data: [
                    45000000, 48000000, 50000000, 49000000, 51000000, 50000000,
                  ],
                  borderColor: "rgba(255, 193, 7, 1)",
                  backgroundColor: "rgba(255, 193, 7, 0.1)",
                  tension: 0.3,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: {
                  display: true,
                  text: "Xu h∆∞·ªõng doanh thu 6 th√°ng g·∫ßn ƒë√¢y",
                },
                legend: {
                  position: "top",
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return (value / 1000000).toFixed(0) + "M";
                    },
                  },
                },
              },
            },
          });
        }
      }

      /**
       * Fallback: Initialize charts with static data
       */
      function initializeServiceCharts() {
        console.warn("‚ö†Ô∏è Using static data for service revenue charts");

        const services = [
          "Membership",
          "PT Fitness",
          "Pilates",
          "Swimming Coach",
        ];
        const staticRevenue = {
          Membership: 1200000000,
          "PT Fitness": 450000000,
          Pilates: 50000000,
          "Swimming Coach": 150000000,
        };
        const staticPercentages = {
          Membership: 64.9,
          "PT Fitness": 24.3,
          Pilates: 2.7,
          "Swimming Coach": 8.1,
        };

        createServiceCharts(services, staticRevenue, staticPercentages);
      }
    </script>

    <!-- SPA System -->
    <script src="../assets/js/spa/store.js"></script>
    <script src="../assets/js/spa/components.js"></script>
    <script src="../assets/js/spa/router.js"></script>
    <script src="../assets/js/spa/integration.js"></script>

    <!-- Universal Page Initializer -->
    <script src="../assets/js/shared/page-initializer.js"></script>
  </body>
</html>
