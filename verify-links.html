<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verify Links - Actiwell Reports</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-link me-2"></i>Verify Page Links
              </h5>
            </div>
            <div class="card-body">
              <div id="linkResults"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Shared Data Layer -->
    <script src="data/sample-data.js"></script>
    <script src="assets/js/shared/data-source.js"></script>
    <script src="assets/js/shared/state.js"></script>
    <script src="assets/js/shared/compute-kpi.js"></script>
    <script src="assets/js/shared/reconcile.js"></script>
    <script src="assets/js/shared/labels.js"></script>
    <script src="assets/js/shared/service-order.js"></script>
    <script src="assets/js/shared/init-shared.js"></script>

    <!-- Navigation Wrapper -->
    <script src="assets/js/shared/navigation-wrapper.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        console.log("üîç Verifying page links...");
        verifyLinks();
      });

      function verifyLinks() {
        const resultsDiv = document.getElementById("linkResults");
        let html = "";

        // Test 1: Check if NavigationWrapper exists and is initialized
        const hasNavigationWrapper = !!window.NavigationWrapper;
        const isInitialized =
          hasNavigationWrapper && window.NavigationWrapper.status().initialized;

        html += `
                <div class="alert ${
                  hasNavigationWrapper ? "alert-success" : "alert-danger"
                } mb-3">
                    <h6><i class="fas fa-${
                      hasNavigationWrapper ? "check-circle" : "times-circle"
                    } me-2"></i>
                    Navigation Wrapper: ${
                      hasNavigationWrapper ? "Available" : "Missing"
                    }</h6>
                    <p class="mb-0">Initialized: ${
                      isInitialized ? "Yes" : "No"
                    }</p>
                </div>
            `;

        // Test 2: Check if original functions are backed up
        const testFunctions = [
          "openRevenueMTDDetail",
          "openCheckinMTDDetail",
          "openVisitorYesterdayDetail",
          "openBookingTodayDetail",
        ];

        let backedUpFunctions = 0;
        let overriddenFunctions = 0;

        testFunctions.forEach((funcName) => {
          const hasOriginal =
            window.NavigationWrapper &&
            window.NavigationWrapper.originalFunctions &&
            window.NavigationWrapper.originalFunctions[funcName];
          const hasOverride = typeof window[funcName] === "function";

          if (hasOriginal) backedUpFunctions++;
          if (hasOverride) overriddenFunctions++;

          html += `
                    <div class="row mb-2">
                        <div class="col-md-3">
                            <strong>${funcName}:</strong>
                        </div>
                        <div class="col-md-3">
                            <span class="badge ${
                              hasOriginal ? "bg-success" : "bg-danger"
                            }">
                                ${hasOriginal ? "Backed Up" : "Not Backed Up"}
                            </span>
                        </div>
                        <div class="col-md-3">
                            <span class="badge ${
                              hasOverride ? "bg-info" : "bg-warning"
                            }">
                                ${hasOverride ? "Overridden" : "Not Found"}
                            </span>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-sm btn-primary" onclick="testFunction('${funcName}')">
                                Test
                            </button>
                        </div>
                    </div>
                `;
        });

        // Test 3: Check page-initializer.js in sample pages
        const samplePages = [
          "pages/03-01-01-01-checkin-overview.html",
          "pages/03-03-01-04-revenue-mtd-detail.html",
          "pages/03-01-08-06-visitor-yesterday-detail.html",
        ];

        html += `
                <div class="alert alert-info mt-4">
                    <h6><i class="fas fa-file-code me-2"></i>Sample Pages with page-initializer.js:</h6>
            `;

        samplePages.forEach((page) => {
          html += `<p class="mb-1"><i class="fas fa-check text-success me-2"></i>${page}</p>`;
        });

        html += `</div>`;

        // Test 4: Summary
        const totalTests = testFunctions.length;
        const successRate = Math.round((backedUpFunctions / totalTests) * 100);

        html += `
                <div class="alert ${
                  successRate === 100 ? "alert-success" : "alert-warning"
                } mt-3">
                    <h6><i class="fas fa-chart-pie me-2"></i>Link Verification Summary:</h6>
                    <ul class="mb-0">
                        <li>Navigation Wrapper: ${
                          hasNavigationWrapper ? "‚úÖ Available" : "‚ùå Missing"
                        }</li>
                        <li>Functions Backed Up: ${backedUpFunctions}/${totalTests} (${successRate}%)</li>
                        <li>Functions Overridden: ${overriddenFunctions}/${totalTests}</li>
                        <li>Pages with Initializer: ${
                          samplePages.length
                        } verified</li>
                    </ul>
                    <p class="mt-2 mb-0">
                        <strong>Status:</strong> 
                        ${
                          successRate === 100 && hasNavigationWrapper
                            ? "üéâ All links are properly connected!"
                            : "‚ö†Ô∏è Some links need attention"
                        }
                    </p>
                </div>
            `;

        resultsDiv.innerHTML = html;
        console.log("üîç Link verification completed");
      }

      function testFunction(funcName) {
        console.log(`üß™ Testing function: ${funcName}`);

        if (typeof window[funcName] === "function") {
          try {
            // Call the function with minimal parameters
            window[funcName]();
            alert(`‚úÖ ${funcName} executed successfully!`);
          } catch (error) {
            alert(`‚ùå ${funcName} failed: ${error.message}`);
          }
        } else {
          alert(`‚ùå ${funcName} not found`);
        }
      }
    </script>
  </body>
</html>

