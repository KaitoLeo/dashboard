<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Danh sách Hội viên - Actiwell Reports</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <i class="fas fa-chart-line me-2"></i>Actiwell Reports
        </a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="../index.html">
            <i class="fas fa-arrow-left me-1"></i>Quay lại Dashboard
          </a>
        </div>
        <div class="navbar-nav">
          <span class="navbar-text text-white">
            <i class="fas fa-clock me-1"></i>
            <span id="currentTime"></span> |
            <span id="currentDate"></span>
          </span>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <h2 class="text-primary">
            <i class="fas fa-users me-2"></i>Danh sách Hội viên
          </h2>
          <p class="text-muted">
            Quản lý và theo dõi thông tin tất cả hội viên trong hệ thống
          </p>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card border-0 shadow-sm bg-primary-subtle">
            <div class="card-body text-center">
              <i class="fas fa-users text-primary fs-1 mb-2"></i>
              <h4 class="text-primary mb-0">1,250</h4>
              <small class="text-muted">Tổng hội viên</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card border-0 shadow-sm bg-success-subtle">
            <div class="card-body text-center">
              <i class="fas fa-user-check text-success fs-1 mb-2"></i>
              <h4 class="text-success mb-0">1,180</h4>
              <small class="text-muted">Hội viên hoạt động</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card border-0 shadow-sm bg-warning-subtle">
            <div class="card-body text-center">
              <i class="fas fa-user-plus text-warning fs-1 mb-2"></i>
              <h4 class="text-warning mb-0">45</h4>
              <small class="text-muted">Hội viên mới</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card border-0 shadow-sm bg-info-subtle">
            <div class="card-body text-center">
              <i class="fas fa-chart-line text-info fs-1 mb-2"></i>
              <h4 class="text-info mb-0">94.4%</h4>
              <small class="text-muted">Tỷ lệ duy trì</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="row mb-4">
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-pie me-2"></i>Phân bố hội viên theo cơ sở
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 350px">
                <canvas id="locationChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-bar me-2"></i>Phân bố hội viên theo gói
                tập
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 350px">
                <canvas id="packageChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Members List Table -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-list me-2"></i>Danh sách hội viên chi tiết
              </h5>
            </div>
            <div class="card-body">
              <!-- Filter Section -->
              <div class="row mb-3">
                <div class="col-md-3">
                  <label class="form-label">Cơ sở</label>
                  <select class="form-select" id="locationFilter">
                    <option value="all">Tất cả cơ sở</option>
                    <option value="ton-that-thuyet">Tôn Thất Thuyết</option>
                    <option value="huynh-thuc-khang">Huỳnh Thúc Kháng</option>
                    <option value="giang-vo">Giảng Võ</option>
                    <option value="hao-nam">Hào Nam</option>
                    <option value="nguyen-tuan">Nguyễn Tuân</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Dịch vụ</label>
                  <select class="form-select" id="serviceFilter">
                    <option value="all">Tất cả dịch vụ</option>
                    <option value="pt-fitness">PT Fitness</option>
                    <option value="pilates">Pilates</option>
                    <option value="swimming-coach">Swimming Coach</option>
                    <option value="membership">Membership</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Số lượt check-in</label>
                  <select class="form-select" id="checkinCountFilter">
                    <option value="all">Tất cả</option>
                    <option value="0-5">0-5 lượt</option>
                    <option value="6-15">6-15 lượt</option>
                    <option value="16-30">16-30 lượt</option>
                    <option value="30+">30+ lượt</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Gói tập</label>
                  <select class="form-select" id="packageFilter">
                    <option value="all">Tất cả gói</option>
                    <option value="basic">Basic</option>
                    <option value="premium">Premium</option>
                    <option value="vip">VIP</option>
                    <option value="unlimited">Unlimited</option>
                  </select>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label">Tìm kiếm</label>
                  <input
                    type="text"
                    class="form-control"
                    id="searchInput"
                    placeholder="Tìm theo tên, số điện thoại, email..."
                  />
                </div>
                <div class="col-md-6 d-flex align-items-end">
                  <button class="btn btn-primary me-2" onclick="applyFilters()">
                    <i class="fas fa-filter me-1"></i>Lọc
                  </button>
                  <button
                    class="btn btn-outline-secondary"
                    onclick="resetFilters()"
                  >
                    <i class="fas fa-undo me-1"></i>Reset
                  </button>
                  <button class="btn btn-success ms-2" onclick="exportData()">
                    <i class="fas fa-download me-1"></i>Xuất Excel
                  </button>
                </div>
              </div>

              <!-- Table -->
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-light">
                    <tr>
                      <th>STT</th>
                      <th>Hội viên</th>
                      <th>Cơ sở</th>
                      <th>Dịch vụ chính</th>
                      <th>Gói tập</th>
                      <th>Check-in tháng</th>
                      <th>Trạng thái</th>
                      <th>Ngày tham gia</th>
                      <th>Hành động</th>
                    </tr>
                  </thead>
                  <tbody id="membersTableBody">
                    <!-- Data will be loaded here -->
                  </tbody>
                </table>
              </div>

              <!-- Pagination -->
              <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center" id="pagination">
                  <!-- Pagination will be generated here -->
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/realtime-clock.js"></script>

    <script>
      // Sample data for members
      const membersData = [
        {
          id: "M001",
          name: "Nguyễn Văn A",
          phone: "0901234567",
          email: "nguyenvana@email.com",
          location: "Tôn Thất Thuyết",
          locationKey: "ton-that-thuyet",
          mainService: "PT Fitness",
          serviceKey: "pt-fitness",
          package: "Premium",
          packageKey: "premium",
          checkinCount: 25,
          status: "Hoạt động",
          statusKey: "active",
          joinDate: "2024-01-15",
          avatar: "NA",
        },
        {
          id: "M002",
          name: "Trần Thị B",
          phone: "0901234568",
          email: "tranthib@email.com",
          location: "Huỳnh Thúc Kháng",
          locationKey: "huynh-thuc-khang",
          mainService: "Pilates",
          serviceKey: "pilates",
          package: "Basic",
          packageKey: "basic",
          checkinCount: 18,
          status: "Hoạt động",
          statusKey: "active",
          joinDate: "2024-02-20",
          avatar: "TB",
        },
        {
          id: "M003",
          name: "Lê Văn C",
          phone: "0901234569",
          email: "levanc@email.com",
          location: "Giảng Võ",
          locationKey: "giang-vo",
          mainService: "Swimming Coach",
          serviceKey: "swimming-coach",
          package: "VIP",
          packageKey: "vip",
          checkinCount: 32,
          status: "Hoạt động",
          statusKey: "active",
          joinDate: "2023-12-10",
          avatar: "LC",
        },
        {
          id: "M004",
          name: "Phạm Thị D",
          phone: "0901234570",
          email: "phamthid@email.com",
          location: "Hào Nam",
          locationKey: "hao-nam",
          mainService: "Membership",
          serviceKey: "membership",
          package: "Unlimited",
          packageKey: "unlimited",
          checkinCount: 45,
          status: "Hoạt động",
          statusKey: "active",
          joinDate: "2023-11-05",
          avatar: "PD",
        },
        {
          id: "M005",
          name: "Hoàng Văn E",
          phone: "0901234571",
          email: "hoangvane@email.com",
          location: "Nguyễn Tuân",
          locationKey: "nguyen-tuan",
          mainService: "PT Fitness",
          serviceKey: "pt-fitness",
          package: "Basic",
          packageKey: "basic",
          checkinCount: 8,
          status: "Tạm dừng",
          statusKey: "paused",
          joinDate: "2024-03-01",
          avatar: "HE",
        },
        {
          id: "M006",
          name: "Vũ Thị F",
          phone: "0901234572",
          email: "vuthif@email.com",
          location: "Tôn Thất Thuyết",
          locationKey: "ton-that-thuyet",
          mainService: "Pilates",
          serviceKey: "pilates",
          package: "Premium",
          packageKey: "premium",
          checkinCount: 22,
          status: "Hoạt động",
          statusKey: "active",
          joinDate: "2024-01-25",
          avatar: "VF",
        },
        {
          id: "M007",
          name: "Đặng Văn G",
          phone: "0901234573",
          email: "dangvang@email.com",
          location: "Huỳnh Thúc Kháng",
          locationKey: "huynh-thuc-khang",
          mainService: "Swimming Coach",
          serviceKey: "swimming-coach",
          package: "Basic",
          packageKey: "basic",
          checkinCount: 12,
          status: "Hoạt động",
          statusKey: "active",
          joinDate: "2024-02-15",
          avatar: "DG",
        },
        {
          id: "M008",
          name: "Bùi Thị H",
          phone: "0901234574",
          email: "buithih@email.com",
          location: "Giảng Võ",
          locationKey: "giang-vo",
          mainService: "Membership",
          serviceKey: "membership",
          package: "VIP",
          packageKey: "vip",
          checkinCount: 38,
          status: "Hoạt động",
          statusKey: "active",
          joinDate: "2023-10-20",
          avatar: "BH",
        },
        // Add more sample data as needed...
      ];

      // Filter functions
      function applyFilters() {
        const location = document.getElementById("locationFilter").value;
        const service = document.getElementById("serviceFilter").value;
        const checkinCount =
          document.getElementById("checkinCountFilter").value;
        const package = document.getElementById("packageFilter").value;
        const search = document
          .getElementById("searchInput")
          .value.toLowerCase();

        let filteredData = membersData.filter((item) => {
          // Location filter
          if (location !== "all" && item.locationKey !== location) return false;

          // Service filter
          if (service !== "all" && item.serviceKey !== service) return false;

          // Check-in count filter
          if (checkinCount !== "all") {
            const count = item.checkinCount;
            switch (checkinCount) {
              case "0-5":
                if (count < 0 || count > 5) return false;
                break;
              case "6-15":
                if (count < 6 || count > 15) return false;
                break;
              case "16-30":
                if (count < 16 || count > 30) return false;
                break;
              case "30+":
                if (count < 31) return false;
                break;
            }
          }

          // Package filter
          if (package !== "all" && item.packageKey !== package) return false;

          // Search filter
          if (
            search &&
            !item.name.toLowerCase().includes(search) &&
            !item.phone.includes(search) &&
            !item.email.toLowerCase().includes(search)
          )
            return false;

          return true;
        });

        loadMembersData(filteredData);
      }

      function resetFilters() {
        document.getElementById("locationFilter").value = "all";
        document.getElementById("serviceFilter").value = "all";
        document.getElementById("checkinCountFilter").value = "all";
        document.getElementById("packageFilter").value = "all";
        document.getElementById("searchInput").value = "";

        loadMembersData(membersData);
      }

      function loadMembersData(data) {
        const tbody = document.getElementById("membersTableBody");
        tbody.innerHTML = "";

        data.forEach((item, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td>
              <div class="d-flex align-items-center">
                <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2">
                  ${item.avatar}
                </div>
                <div>
                  <div class="fw-bold">${item.name}</div>
                  <small class="text-muted">${item.phone}</small>
                </div>
              </div>
            </td>
            <td>${item.location}</td>
            <td>
              <span class="badge bg-${getServiceBadgeClass(item.serviceKey)}">
                ${item.mainService}
              </span>
            </td>
            <td>
              <span class="badge bg-${getPackageBadgeClass(item.packageKey)}">
                ${item.package}
              </span>
            </td>
            <td>
              <span class="fw-bold">${item.checkinCount}</span>
              <small class="text-muted">lượt</small>
            </td>
            <td>
              <span class="badge bg-${getStatusBadgeClass(item.statusKey)}">
                ${item.status}
              </span>
            </td>
            <td>${formatDate(item.joinDate)}</td>
            <td>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary" onclick="viewMember('${
                  item.id
                }')">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-outline-warning" onclick="editMember('${
                  item.id
                }')">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-outline-info" onclick="viewHistory('${
                  item.id
                }')">
                  <i class="fas fa-history"></i>
                </button>
              </div>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function getServiceBadgeClass(service) {
        const classes = {
          "pt-fitness": "primary",
          pilates: "warning",
          "swimming-coach": "success",
          membership: "info",
        };
        return classes[service] || "secondary";
      }

      function getPackageBadgeClass(package) {
        const classes = {
          basic: "secondary",
          premium: "primary",
          vip: "warning",
          unlimited: "success",
        };
        return classes[package] || "secondary";
      }

      function getStatusBadgeClass(status) {
        const classes = {
          active: "success",
          paused: "warning",
          inactive: "danger",
        };
        return classes[status] || "secondary";
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("vi-VN");
      }

      // Action functions
      function viewMember(memberId) {
        alert(`Xem thông tin hội viên: ${memberId}`);
      }

      function editMember(memberId) {
        alert(`Chỉnh sửa hội viên: ${memberId}`);
      }

      function viewHistory(memberId) {
        alert(`Xem lịch sử hội viên: ${memberId}`);
      }

      function exportData() {
        alert("Xuất dữ liệu Excel...");
      }

      // Chart creation
      function createCharts() {
        // Location Chart
        const locationCtx = document.getElementById("locationChart");
        if (locationCtx) {
          new Chart(locationCtx, {
            type: "doughnut",
            data: {
              labels: [
                "Tôn Thất Thuyết",
                "Huỳnh Thúc Kháng",
                "Giảng Võ",
                "Hào Nam",
                "Nguyễn Tuân",
              ],
              datasets: [
                {
                  data: [280, 250, 240, 230, 250],
                  backgroundColor: [
                    "#007bff",
                    "#28a745",
                    "#ffc107",
                    "#dc3545",
                    "#6f42c1",
                  ],
                  borderWidth: 2,
                  borderColor: "#fff",
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "right",
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      const total = context.dataset.data.reduce(
                        (a, b) => a + b,
                        0
                      );
                      const percentage = (
                        (context.parsed / total) *
                        100
                      ).toFixed(1);
                      return `${context.label}: ${context.parsed} (${percentage}%)`;
                    },
                  },
                },
              },
            },
          });
        }

        // Package Chart
        const packageCtx = document.getElementById("packageChart");
        if (packageCtx) {
          new Chart(packageCtx, {
            type: "bar",
            data: {
              labels: ["Basic", "Premium", "VIP", "Unlimited"],
              datasets: [
                {
                  label: "Số hội viên",
                  data: [450, 380, 250, 170],
                  backgroundColor: ["#6c757d", "#007bff", "#ffc107", "#28a745"],
                  borderColor: ["#5a6268", "#0056b3", "#e0a800", "#1e7e34"],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
        }
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        console.log("Members list page loaded");
        loadMembersData(membersData);
        createCharts();
      });
    </script>
  
    <!-- SPA System -->
    <script src="../assets/js/spa/store.js"></script>
    <script src="../assets/js/spa/components.js"></script>
    <script src="../assets/js/spa/router.js"></script>
    <script src="../assets/js/spa/integration.js"></script>
</body>
</html>
