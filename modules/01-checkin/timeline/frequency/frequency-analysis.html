<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phân tích tần suất Check-in - Actiwell Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <style>
      /* Simple and clean table styles */
      .table th {
        font-weight: 600;
        font-size: 14px;
        padding: 12px 8px;
        border-bottom: 2px solid #dee2e6;
      }

      .table td {
        padding: 12px 8px;
        vertical-align: middle;
        font-size: 14px;
      }

      .table tbody tr:hover {
        background-color: #f8f9fa;
      }

      .table-responsive {
        border-radius: 0.375rem;
      }

      .card-header {
        font-size: 16px;
        font-weight: 600;
      }

      .btn-sm {
        font-size: 12px;
        padding: 0.375rem 0.75rem;
      }

      /* Professional clickable elements */
      .clickable-location,
      .clickable-department {
        position: relative;
        overflow: hidden;
      }

      .clickable-location::before,
      .clickable-department::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(13, 110, 253, 0.1),
          transparent
        );
        transition: left 0.5s;
      }

      .clickable-location:hover::before,
      .clickable-department:hover::before {
        left: 100%;
      }

      .clickable-location:active,
      .clickable-department:active {
        transform: translateY(0) scale(0.98);
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <i class="fas fa-chart-line me-2"></i>Actiwell Dashboard
        </a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="checkin-overview.html">
            <i class="fas fa-arrow-left me-1"></i>Quay lại
          </a>
        </div>
        <div class="navbar-nav">
          <span class="navbar-text text-white">
            <i class="fas fa-clock me-1"></i>
            <span id="currentTime"></span> |
            <span id="currentDate"></span>
          </span>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="d-flex align-items-center">
            <i class="fas fa-chart-line text-info fs-3 me-3"></i>
            <div>
              <h2 class="text-info mb-0">Phân tích tần suất Check-in</h2>
              <p class="text-muted mb-0">
                Thống kê chi tiết tần suất check-in của hội viên theo cơ sở và
                bộ phận
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Bộ lọc</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Cơ sở</label>
                  <select class="form-select" id="locationFilter">
                    <option value="all">Tất cả cơ sở</option>
                    <option value="ton-that-thuyet">Tôn Thất Thuyết</option>
                    <option value="huynh-thuc-khang">Huỳnh Thúc Kháng</option>
                    <option value="giang-vo">Giảng Võ</option>
                    <option value="hao-nam">Hào Nam</option>
                    <option value="nguyen-tuan">Nguyễn Tuân</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Bộ phận</label>
                  <select class="form-select" id="departmentFilter">
                    <option value="all">Tất cả bộ phận</option>
                    <option value="membership">Membership</option>
                    <option value="pt">PT Fitness</option>
                    <option value="pilates">Pilates</option>
                    <option value="swimming-coach">Swimming Coach</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Khoảng thời gian</label>
                  <select class="form-select" id="timeRangeFilter">
                    <option value="this-week">Tuần này</option>
                    <option value="last-week">Tuần trước</option>
                    <option value="this-month">Tháng này</option>
                    <option value="last-month">Tháng trước</option>
                    <option value="custom">Tùy chỉnh</option>
                  </select>
                </div>
                <div class="col-md-3 mb-3 d-flex align-items-end">
                  <button
                    class="btn btn-primary w-100"
                    onclick="applyFilters()"
                  >
                    <i class="fas fa-search me-1"></i>Áp dụng
                  </button>
                </div>
              </div>
              <!-- Custom date range (hidden by default) -->
              <div class="row" id="customDateRange" style="display: none">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Từ ngày</label>
                  <input type="date" class="form-control" id="startDate" />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Đến ngày</label>
                  <input type="date" class="form-control" id="endDate" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-primary text-white">
            <div class="card-body text-center">
              <i class="fas fa-users fa-2x text-white mb-2"></i>
              <h6 class="text-white">Tổng hội viên</h6>
              <h4 class="text-white" id="totalMembers">1,250</h4>
              <small class="text-white-50">đang hoạt động</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-success text-white">
            <div class="card-body text-center">
              <i class="fas fa-chart-line fa-2x text-white mb-2"></i>
              <h6 class="text-white">Tần suất trung bình</h6>
              <h4 class="text-white" id="avgFrequency">3.2</h4>
              <small class="text-white-50">lần/tuần</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-warning text-dark">
            <div class="card-body text-center">
              <i class="fas fa-star fa-2x text-dark mb-2"></i>
              <h6 class="text-dark">Hội viên tích cực</h6>
              <h4 class="text-dark" id="activeMembers">456</h4>
              <small class="text-dark">>4 lần/tuần</small>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card bg-info text-white">
            <div class="card-body text-center">
              <i class="fas fa-percentage fa-2x text-white mb-2"></i>
              <h6 class="text-white">Tỷ lệ duy trì</h6>
              <h4 class="text-white" id="retentionRate">78.5%</h4>
              <small class="text-white-50">tháng này</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Frequency Analysis Table -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                  <i class="fas fa-chart-bar me-2"></i>PHÂN TÍCH TẦN SUẤT CHECK
                  IN CỦA HỘI VIÊN
                </h5>
                <div>
                  <button
                    class="btn btn-light btn-sm me-2"
                    onclick="exportToExcel()"
                  >
                    <i class="fas fa-download me-1"></i>Xuất Excel
                  </button>
                  <button
                    class="btn btn-outline-light btn-sm"
                    onclick="refreshData()"
                  >
                    <i class="fas fa-sync-alt me-1"></i>Làm mới
                  </button>
                </div>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table
                  class="table table-bordered table-striped mb-0"
                  id="frequencyTable"
                >
                  <thead class="table-light">
                    <tr>
                      <th style="width: 8%; text-align: center">STT</th>
                      <th style="width: 25%">Cơ sở</th>
                      <th style="width: 20%">Bộ phận</th>
                      <th style="width: 12%; text-align: center">
                        &lt;2 lần/tuần
                      </th>
                      <th style="width: 12%; text-align: center">
                        2-4 lần/tuần
                      </th>
                      <th style="width: 12%; text-align: center">
                        &gt;4 lần/tuần
                      </th>
                      <th style="width: 12%; text-align: center">
                        &gt;7 lần/tuần
                      </th>
                    </tr>
                  </thead>
                  <tbody id="frequencyTableBody">
                    <!-- Data will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="row mt-4">
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-pie me-2"></i>Phân bổ theo tần suất
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="frequencyDistributionChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-bar me-2"></i>So sánh theo cơ sở
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="locationComparisonChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for showing member list -->
    <div
      class="modal fade"
      id="memberListModal"
      tabindex="-1"
      aria-labelledby="memberListModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="memberListModalLabel">
              <i class="fas fa-users me-2"></i>Danh sách hội viên
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-search"></i
                  ></span>
                  <input
                    type="text"
                    class="form-control"
                    id="memberSearchInput"
                    placeholder="Tìm kiếm hội viên..."
                  />
                </div>
              </div>
              <div class="col-md-6">
                <select class="form-select" id="frequencyFilter">
                  <option value="all">Tất cả tần suất</option>
                  <option value="low"><2 lần/tuần</option>
                  <option value="medium">2-4 lần/tuần</option>
                  <option value="high">>4 lần/tuần</option>
                  <option value="veryHigh">>7 lần/tuần</option>
                </select>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table table-hover" id="memberListTable">
                <thead class="table-dark">
                  <tr>
                    <th>STT</th>
                    <th>Hội viên</th>
                    <th>Bộ phận</th>
                    <th>Tần suất check-in</th>
                    <th>Số lần/tuần</th>
                    <th>Lần check-in gần nhất</th>
                    <th>Trạng thái</th>
                  </tr>
                </thead>
                <tbody id="memberListTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Đóng
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="exportMemberList()"
            >
              <i class="fas fa-download me-1"></i>Xuất Excel
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../assets/js/main.js"></script>
    <script>
      // Sample member data
      const memberData = {
        "ton-that-thuyet": {
          membership: {
            low: [
              {
                id: 1,
                name: "Nguyễn Văn A",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-15",
                status: "inactive",
              },
              {
                id: 2,
                name: "Trần Thị B",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-14",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 3,
                name: "Lê Văn C",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
              {
                id: 4,
                name: "Phạm Thị D",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 5,
                name: "Hoàng Văn E",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
              {
                id: 6,
                name: "Võ Thị F",
                frequency: "high",
                timesPerWeek: 6,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 7,
                name: "Ngô Văn G",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
              {
                id: 8,
                name: "Lý Thị H",
                frequency: "veryHigh",
                timesPerWeek: 9,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pt: {
            low: [
              {
                id: 9,
                name: "Đỗ Văn I",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-13",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 10,
                name: "Bùi Thị K",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 11,
                name: "Phan Văn L",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 12,
                name: "Vũ Thị M",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pilates: {
            low: [
              {
                id: 13,
                name: "Đinh Văn N",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-12",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 14,
                name: "Hồ Thị O",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 15,
                name: "Lương Văn P",
                frequency: "high",
                timesPerWeek: 4,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 16,
                name: "Tôn Thị Q",
                frequency: "veryHigh",
                timesPerWeek: 7,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          "swimming-coach": {
            low: [
              {
                id: 17,
                name: "Trịnh Văn R",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-11",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 18,
                name: "Nguyễn Thị S",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 19,
                name: "Lê Văn T",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 20,
                name: "Phạm Thị U",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
        },
        "huynh-thuc-khang": {
          membership: {
            low: [
              {
                id: 21,
                name: "Hoàng Văn V",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-14",
                status: "inactive",
              },
              {
                id: 22,
                name: "Võ Thị W",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-13",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 23,
                name: "Ngô Văn X",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
              {
                id: 24,
                name: "Lý Thị Y",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 25,
                name: "Đỗ Văn Z",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
              {
                id: 26,
                name: "Bùi Thị AA",
                frequency: "high",
                timesPerWeek: 6,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 27,
                name: "Phan Văn BB",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
              {
                id: 28,
                name: "Vũ Thị CC",
                frequency: "veryHigh",
                timesPerWeek: 9,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pt: {
            low: [
              {
                id: 29,
                name: "Đinh Văn DD",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-12",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 30,
                name: "Hồ Thị EE",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 31,
                name: "Lương Văn FF",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 32,
                name: "Tôn Thị GG",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pilates: {
            low: [
              {
                id: 33,
                name: "Trịnh Văn HH",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-11",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 34,
                name: "Nguyễn Thị II",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 35,
                name: "Lê Văn JJ",
                frequency: "high",
                timesPerWeek: 4,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 36,
                name: "Phạm Thị KK",
                frequency: "veryHigh",
                timesPerWeek: 7,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          "swimming-coach": {
            low: [
              {
                id: 37,
                name: "Hoàng Văn LL",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-10",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 38,
                name: "Võ Thị MM",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 39,
                name: "Ngô Văn NN",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 40,
                name: "Lý Thị OO",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
        },
        "giang-vo": {
          membership: {
            low: [
              {
                id: 41,
                name: "Đỗ Văn PP",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-13",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 42,
                name: "Bùi Thị QQ",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 43,
                name: "Phan Văn RR",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 44,
                name: "Vũ Thị SS",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pt: {
            low: [
              {
                id: 45,
                name: "Đinh Văn TT",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-12",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 46,
                name: "Hồ Thị UU",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 47,
                name: "Lương Văn VV",
                frequency: "high",
                timesPerWeek: 4,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 48,
                name: "Tôn Thị WW",
                frequency: "veryHigh",
                timesPerWeek: 7,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pilates: {
            low: [
              {
                id: 49,
                name: "Trịnh Văn XX",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-11",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 50,
                name: "Nguyễn Thị YY",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 51,
                name: "Lê Văn ZZ",
                frequency: "high",
                timesPerWeek: 4,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 52,
                name: "Phạm Thị AAA",
                frequency: "veryHigh",
                timesPerWeek: 6,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          "swimming-coach": {
            low: [
              {
                id: 53,
                name: "Hoàng Văn BBB",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-10",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 54,
                name: "Võ Thị CCC",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 55,
                name: "Ngô Văn DDD",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 56,
                name: "Lý Thị EEE",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
        },
        "hao-nam": {
          membership: {
            low: [
              {
                id: 57,
                name: "Đỗ Văn FFF",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-13",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 58,
                name: "Bùi Thị GGG",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 59,
                name: "Phan Văn HHH",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 60,
                name: "Vũ Thị III",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pt: {
            low: [
              {
                id: 61,
                name: "Đinh Văn JJJ",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-12",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 62,
                name: "Hồ Thị KKK",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 63,
                name: "Lương Văn LLL",
                frequency: "high",
                timesPerWeek: 4,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 64,
                name: "Tôn Thị MMM",
                frequency: "veryHigh",
                timesPerWeek: 7,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pilates: {
            low: [
              {
                id: 65,
                name: "Trịnh Văn NNN",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-11",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 66,
                name: "Nguyễn Thị OOO",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 67,
                name: "Lê Văn PPP",
                frequency: "high",
                timesPerWeek: 4,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 68,
                name: "Phạm Thị QQQ",
                frequency: "veryHigh",
                timesPerWeek: 6,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          "swimming-coach": {
            low: [
              {
                id: 69,
                name: "Hoàng Văn RRR",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-10",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 70,
                name: "Võ Thị SSS",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 71,
                name: "Ngô Văn TTT",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 72,
                name: "Lý Thị UUU",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
        },
        "nguyen-tuan": {
          membership: {
            low: [
              {
                id: 73,
                name: "Đỗ Văn VVV",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-13",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 74,
                name: "Bùi Thị WWW",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 75,
                name: "Phan Văn XXX",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 76,
                name: "Vũ Thị YYY",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pt: {
            low: [
              {
                id: 77,
                name: "Đinh Văn ZZZ",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-12",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 78,
                name: "Hồ Thị AAAA",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 79,
                name: "Lương Văn BBBB",
                frequency: "high",
                timesPerWeek: 4,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 80,
                name: "Tôn Thị CCCC",
                frequency: "veryHigh",
                timesPerWeek: 7,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          pilates: {
            low: [
              {
                id: 81,
                name: "Trịnh Văn DDDD",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-11",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 82,
                name: "Nguyễn Thị EEEE",
                frequency: "medium",
                timesPerWeek: 2,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 83,
                name: "Lê Văn FFFF",
                frequency: "high",
                timesPerWeek: 4,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 84,
                name: "Phạm Thị GGGG",
                frequency: "veryHigh",
                timesPerWeek: 6,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
          "swimming-coach": {
            low: [
              {
                id: 85,
                name: "Hoàng Văn HHHH",
                frequency: "low",
                timesPerWeek: 1,
                lastCheckin: "2024-01-10",
                status: "inactive",
              },
            ],
            medium: [
              {
                id: 86,
                name: "Võ Thị IIII",
                frequency: "medium",
                timesPerWeek: 3,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            high: [
              {
                id: 87,
                name: "Ngô Văn JJJJ",
                frequency: "high",
                timesPerWeek: 5,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
            veryHigh: [
              {
                id: 88,
                name: "Lý Thị KKKK",
                frequency: "veryHigh",
                timesPerWeek: 8,
                lastCheckin: "2024-01-16",
                status: "active",
              },
            ],
          },
        },
      };

      // Sample data for frequency analysis
      const frequencyData = {
        "ton-that-thuyet": {
          name: "Tôn Thất Thuyết",
          membership: { low: 12, medium: 45, high: 28, veryHigh: 8 },
          pt: { low: 8, medium: 32, high: 18, veryHigh: 5 },
          pilates: { low: 5, medium: 15, high: 12, veryHigh: 3 },
          "swimming-coach": { low: 3, medium: 12, high: 8, veryHigh: 2 },
        },
        "huynh-thuc-khang": {
          name: "Huỳnh Thúc Kháng",
          membership: { low: 15, medium: 52, high: 35, veryHigh: 12 },
          pt: { low: 10, medium: 38, high: 22, veryHigh: 8 },
          pilates: { low: 6, medium: 18, high: 15, veryHigh: 4 },
          "swimming-coach": { low: 4, medium: 15, high: 10, veryHigh: 3 },
        },
        "giang-vo": {
          name: "Giảng Võ",
          membership: { low: 8, medium: 28, high: 18, veryHigh: 5 },
          pt: { low: 6, medium: 22, high: 12, veryHigh: 3 },
          pilates: { low: 3, medium: 10, high: 8, veryHigh: 2 },
          "swimming-coach": { low: 2, medium: 8, high: 5, veryHigh: 1 },
        },
        "hao-nam": {
          name: "Hào Nam",
          membership: { low: 10, medium: 35, high: 22, veryHigh: 6 },
          pt: { low: 7, medium: 28, high: 15, veryHigh: 4 },
          pilates: { low: 4, medium: 12, high: 10, veryHigh: 2 },
          "swimming-coach": { low: 3, medium: 10, high: 6, veryHigh: 2 },
        },
        "nguyen-tuan": {
          name: "Nguyễn Tuân",
          membership: { low: 6, medium: 22, high: 15, veryHigh: 4 },
          pt: { low: 4, medium: 18, high: 10, veryHigh: 2 },
          pilates: { low: 2, medium: 8, high: 6, veryHigh: 1 },
          "swimming-coach": { low: 1, medium: 6, high: 4, veryHigh: 1 },
        },
      };

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM loaded, initializing page...");
        updateDateTime();
        loadFrequencyData();
        createCharts();
        setInterval(updateDateTime, 1000);
      });

      // Also try to load data immediately if DOM is already loaded
      if (document.readyState === "loading") {
        console.log("Document still loading...");
      } else {
        console.log("Document already loaded, loading data immediately...");
        updateDateTime();
        loadFrequencyData();
        createCharts();
        setInterval(updateDateTime, 1000);
      }

      function updateDateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString("vi-VN");
        const dateString = now.toLocaleDateString("vi-VN");

        const timeElement = document.getElementById("currentTime");
        const dateElement = document.getElementById("currentDate");

        if (timeElement) timeElement.textContent = timeString;
        if (dateElement) dateElement.textContent = dateString;
      }

      function loadFrequencyData() {
        console.log("Loading frequency data...");
        const tbody = document.getElementById("frequencyTableBody");
        if (!tbody) {
          console.error("Table body not found!");
          return;
        }
        tbody.innerHTML = "";

        console.log("Frequency data:", frequencyData);

        let rowIndex = 1;
        Object.keys(frequencyData).forEach((locationKey, locationIndex) => {
          const location = frequencyData[locationKey];
          const departments = ["membership", "pt", "pilates", "swimming-coach"];

          departments.forEach((dept, deptIndex) => {
            const row = document.createElement("tr");
            const deptName = getDepartmentDisplayName(dept);
            const data = location[dept];

            // Tạo HTML cho từng dòng
            let rowHTML = "";

            // Cột STT - chỉ hiển thị ở dòng đầu tiên của mỗi location
            if (deptIndex === 0) {
              rowHTML += `<td style="text-align: center; vertical-align: middle; font-weight: bold; background-color: #f8f9fa;" rowspan="4">${
                locationIndex + 1
              }</td>`;
            }

            // Cột Cơ sở - chỉ hiển thị ở dòng đầu tiên của mỗi location
            if (deptIndex === 0) {
              rowHTML += `<td style="vertical-align: middle; font-weight: bold; background-color: #f8f9fa;" rowspan="4">
                <span class="clickable-location" style="cursor: pointer; color: #495057; padding: 4px 8px; border-radius: 4px; transition: all 0.2s ease; display: inline-block;" 
                      onmouseover="this.style.backgroundColor='#e9ecef'; this.style.color='#0d6efd'; this.style.transform='translateY(-1px)'" 
                      onmouseout="this.style.backgroundColor='transparent'; this.style.color='#495057'; this.style.transform='translateY(0)'"
                      onclick="showLocationMembers('${locationKey}')" 
                      title="Click để xem danh sách hội viên">
                  <i class="fas fa-building me-1"></i>${location.name}
                </span>
              </td>`;
            }

            // Cột Bộ phận - hiển thị ở tất cả các dòng
            rowHTML += `<td style="vertical-align: middle; font-weight: 500;">
              <span class="clickable-department" style="cursor: pointer; color: #6c757d; padding: 3px 6px; border-radius: 3px; transition: all 0.2s ease; display: inline-block;" 
                    onmouseover="this.style.backgroundColor='#f8f9fa'; this.style.color='#0d6efd'; this.style.transform='translateY(-1px)'" 
                    onmouseout="this.style.backgroundColor='transparent'; this.style.color='#6c757d'; this.style.transform='translateY(0)'"
                    onclick="showDepartmentMembers('${locationKey}', '${dept}')" 
                    title="Click để xem danh sách hội viên">
                <i class="fas fa-users me-1"></i>${deptName}
              </span>
            </td>`;

            // Các cột số liệu - hiển thị ở tất cả các dòng
            rowHTML += `<td style="text-align: center; vertical-align: middle; font-weight: bold; color: #dc3545;">${data.low}</td>`;
            rowHTML += `<td style="text-align: center; vertical-align: middle; font-weight: bold; color: #ffc107;">${data.medium}</td>`;
            rowHTML += `<td style="text-align: center; vertical-align: middle; font-weight: bold; color: #198754;">${data.high}</td>`;
            rowHTML += `<td style="text-align: center; vertical-align: middle; font-weight: bold; color: #0d6efd;">${data.veryHigh}</td>`;

            row.innerHTML = rowHTML;
            tbody.appendChild(row);
          });
        });
        console.log("Frequency data loaded successfully!");
      }

      function getDepartmentIcon(dept) {
        const icons = {
          membership: "fas fa-id-card",
          pt: "fas fa-dumbbell",
          pilates: "fas fa-leaf",
          "swimming-coach": "fas fa-swimmer",
        };
        return icons[dept] || "fas fa-users";
      }

      function getDepartmentColor(dept) {
        const colors = {
          membership: "text-primary",
          pt: "text-warning",
          pilates: "text-pink",
          "swimming-coach": "text-info",
        };
        return colors[dept] || "text-secondary";
      }

      function getDepartmentDisplayName(dept) {
        const names = {
          membership: "Membership",
          pt: "PT Fitness",
          pilates: "Pilates",
          "swimming-coach": "Swimming Coach",
        };
        return names[dept] || dept;
      }

      function createCharts() {
        // Frequency Distribution Chart
        const frequencyCtx = document
          .getElementById("frequencyDistributionChart")
          .getContext("2d");
        new Chart(frequencyCtx, {
          type: "doughnut",
          data: {
            labels: [
              "<2 lần/tuần",
              "2-4 lần/tuần",
              ">4 lần/tuần",
              ">7 lần/tuần",
            ],
            datasets: [
              {
                data: [120, 450, 280, 95],
                backgroundColor: ["#dc3545", "#ffc107", "#198754", "#0d6efd"],
                borderWidth: 2,
                borderColor: "#fff",
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: "bottom",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const total = context.dataset.data.reduce(
                      (a, b) => a + b,
                      0
                    );
                    const percentage = ((context.parsed / total) * 100).toFixed(
                      1
                    );
                    return `${context.label}: ${context.parsed} hội viên (${percentage}%)`;
                  },
                },
              },
            },
          },
        });

        // Location Comparison Chart
        const locationCtx = document
          .getElementById("locationComparisonChart")
          .getContext("2d");
        new Chart(locationCtx, {
          type: "bar",
          data: {
            labels: [
              "Tôn Thất Thuyết",
              "Huỳnh Thúc Kháng",
              "Giảng Võ",
              "Hào Nam",
              "Nguyễn Tuân",
            ],
            datasets: [
              {
                label: "<2 lần/tuần",
                data: [28, 35, 19, 24, 13],
                backgroundColor: "#dc3545",
              },
              {
                label: "2-4 lần/tuần",
                data: [104, 123, 48, 65, 34],
                backgroundColor: "#ffc107",
              },
              {
                label: ">4 lần/tuần",
                data: [66, 82, 43, 53, 26],
                backgroundColor: "#198754",
              },
              {
                label: ">7 lần/tuần",
                data: [18, 27, 11, 14, 7],
                backgroundColor: "#0d6efd",
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              x: {
                stacked: true,
              },
              y: {
                stacked: true,
                beginAtZero: true,
              },
            },
            plugins: {
              legend: {
                position: "top",
              },
            },
          },
        });
      }

      function applyFilters() {
        const location = document.getElementById("locationFilter").value;
        const department = document.getElementById("departmentFilter").value;
        const timeRange = document.getElementById("timeRangeFilter").value;

        console.log("Applying filters:", { location, department, timeRange });

        // Show/hide custom date range
        const customDateRange = document.getElementById("customDateRange");
        if (timeRange === "custom") {
          customDateRange.style.display = "block";
        } else {
          customDateRange.style.display = "none";
        }

        // Reload data with filters
        loadFrequencyData();
        createCharts();
      }

      function exportToExcel() {
        alert("Chức năng xuất Excel sẽ được triển khai sau");
      }

      function refreshData() {
        loadFrequencyData();
        createCharts();
        console.log("Data refreshed");
      }

      // Function to show members by location
      function showLocationMembers(locationKey) {
        const location = frequencyData[locationKey];
        if (!location) return;

        const modal = new bootstrap.Modal(
          document.getElementById("memberListModal")
        );
        document.getElementById(
          "memberListModalLabel"
        ).innerHTML = `<i class="fas fa-users me-2"></i>Danh sách hội viên - ${location.name}`;

        // Get all members from all departments in this location
        let allMembers = [];
        const departments = ["membership", "pt", "pilates", "swimming-coach"];

        departments.forEach((dept) => {
          if (memberData[locationKey] && memberData[locationKey][dept]) {
            Object.keys(memberData[locationKey][dept]).forEach((frequency) => {
              allMembers = allMembers.concat(
                memberData[locationKey][dept][frequency]
              );
            });
          }
        });

        displayMemberList(allMembers);
        modal.show();
      }

      // Function to show members by department
      function showDepartmentMembers(locationKey, department) {
        const location = frequencyData[locationKey];
        const deptName = getDepartmentDisplayName(department);
        if (!location) return;

        const modal = new bootstrap.Modal(
          document.getElementById("memberListModal")
        );
        document.getElementById(
          "memberListModalLabel"
        ).innerHTML = `<i class="fas fa-users me-2"></i>Danh sách hội viên - ${location.name} - ${deptName}`;

        // Get all members from this specific department
        let allMembers = [];
        if (memberData[locationKey] && memberData[locationKey][department]) {
          Object.keys(memberData[locationKey][department]).forEach(
            (frequency) => {
              allMembers = allMembers.concat(
                memberData[locationKey][department][frequency]
              );
            }
          );
        }

        displayMemberList(allMembers);
        modal.show();
      }

      // Function to display member list in modal
      function displayMemberList(members) {
        const tbody = document.getElementById("memberListTableBody");
        tbody.innerHTML = "";

        members.forEach((member, index) => {
          const row = document.createElement("tr");
          const frequencyText = getFrequencyText(member.frequency);
          const statusBadge = getStatusBadge(member.status);

          row.innerHTML = `
            <td>${index + 1}</td>
            <td>
              <div class="d-flex align-items-center">
                <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px; font-size: 12px;">
                  ${member.name.charAt(0)}
                </div>
                <div>
                  <div class="fw-bold">${member.name}</div>
                  <small class="text-muted">ID: ${member.id}</small>
                </div>
              </div>
            </td>
            <td>
              <span class="badge bg-info">${getDepartmentDisplayName(
                member.department || "membership"
              )}</span>
            </td>
            <td>
              <span class="badge ${getFrequencyBadgeClass(
                member.frequency
              )}">${frequencyText}</span>
            </td>
            <td class="text-center fw-bold">${member.timesPerWeek}</td>
            <td>
              <small class="text-muted">${formatDate(
                member.lastCheckin
              )}</small>
            </td>
            <td>${statusBadge}</td>
          `;
          tbody.appendChild(row);
        });

        // Add search and filter functionality
        setupMemberListFilters();
      }

      // Helper functions
      function getFrequencyText(frequency) {
        const texts = {
          low: "<2 lần/tuần",
          medium: "2-4 lần/tuần",
          high: ">4 lần/tuần",
          veryHigh: ">7 lần/tuần",
        };
        return texts[frequency] || frequency;
      }

      function getFrequencyBadgeClass(frequency) {
        const classes = {
          low: "bg-danger",
          medium: "bg-warning",
          high: "bg-success",
          veryHigh: "bg-primary",
        };
        return classes[frequency] || "bg-secondary";
      }

      function getStatusBadge(status) {
        if (status === "active") {
          return '<span class="badge bg-success">Hoạt động</span>';
        } else {
          return '<span class="badge bg-secondary">Không hoạt động</span>';
        }
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("vi-VN");
      }

      function setupMemberListFilters() {
        const searchInput = document.getElementById("memberSearchInput");
        const frequencyFilter = document.getElementById("frequencyFilter");

        // Clear previous event listeners
        searchInput.oninput = null;
        frequencyFilter.onchange = null;

        // Add new event listeners
        searchInput.oninput = function () {
          filterMemberList();
        };

        frequencyFilter.onchange = function () {
          filterMemberList();
        };
      }

      function filterMemberList() {
        const searchTerm = document
          .getElementById("memberSearchInput")
          .value.toLowerCase();
        const frequencyFilter =
          document.getElementById("frequencyFilter").value;
        const rows = document.querySelectorAll("#memberListTableBody tr");

        rows.forEach((row) => {
          const name = row.cells[1].textContent.toLowerCase();
          const frequency = row.cells[3].textContent;

          const matchesSearch = name.includes(searchTerm);
          const matchesFrequency =
            frequencyFilter === "all" ||
            (frequencyFilter === "low" && frequency.includes("<2")) ||
            (frequencyFilter === "medium" && frequency.includes("2-4")) ||
            (frequencyFilter === "high" &&
              frequency.includes(">4") &&
              !frequency.includes(">7")) ||
            (frequencyFilter === "veryHigh" && frequency.includes(">7"));

          if (matchesSearch && matchesFrequency) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function exportMemberList() {
        alert("Chức năng xuất Excel danh sách hội viên sẽ được triển khai sau");
      }
    </script>
  
    <!-- SPA System -->
    <script src="../assets/js/spa/store.js"></script>
    <script src="../assets/js/spa/components.js"></script>
    <script src="../assets/js/spa/router.js"></script>
    <script src="../assets/js/spa/integration.js"></script>
</body>
</html>
