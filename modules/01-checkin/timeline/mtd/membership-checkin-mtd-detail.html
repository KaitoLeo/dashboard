<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi tiết Membership Check-in MTD - Actiwell Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav
      class="navbar navbar-expand-lg navbar-dark"
      style="background-color: #e83e8c"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <i class="fas fa-chart-line me-2"></i>Actiwell Reports
        </a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="checkin-mtd-detail.html">
            <i class="fas fa-arrow-left me-1"></i>Quay lại Check-in MTD
          </a>
        </div>
        <div class="navbar-nav">
          <span class="navbar-text text-white">
            <i class="fas fa-clock me-1"></i>
            <span id="currentTime"></span> |
            <span id="currentDate"></span>
          </span>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <h2 class="text-pink">
            <i class="fas fa-users me-2"></i>Chi tiết Membership Check-in MTD
          </h2>
          <p class="text-muted">
            Thống kê chi tiết về hoạt động Membership từ đầu tháng đến nay
          </p>
        </div>
      </div>

      <!-- Metric Cards -->
      <div class="row mb-4">
        <div class="col mb-3">
          <div class="card border-0 shadow-sm bg-pink-subtle">
            <div class="card-body">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-calendar-minus text-pink fs-4 me-2"></i>
                <h6 class="mb-0 text-pink">Check-in tháng này</h6>
              </div>
              <h4 class="text-pink mb-0">1,250</h4>
              <small class="text-muted">lượt</small>
            </div>
          </div>
        </div>
        <div class="col mb-3">
          <div class="card border-0 shadow-sm bg-primary-subtle">
            <div class="card-body">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-dumbbell text-primary fs-4 me-2"></i>
                <h6 class="mb-0 text-primary">Gym</h6>
              </div>
              <h4 class="text-primary mb-0">500</h4>
              <small class="text-muted">lượt</small>
            </div>
          </div>
        </div>
        <div class="col mb-3">
          <div class="card border-0 shadow-sm bg-success-subtle">
            <div class="card-body">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-leaf text-success fs-4 me-2"></i>
                <h6 class="mb-0 text-success">Yoga</h6>
              </div>
              <h4 class="text-success mb-0">310</h4>
              <small class="text-muted">lượt</small>
            </div>
          </div>
        </div>
        <div class="col mb-3">
          <div class="card border-0 shadow-sm bg-warning-subtle">
            <div class="card-body">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-users text-warning fs-4 me-2"></i>
                <h6 class="mb-0 text-warning">Group X</h6>
              </div>
              <h4 class="text-warning mb-0">290</h4>
              <small class="text-muted">lượt</small>
            </div>
          </div>
        </div>
        <div class="col mb-3">
          <div class="card border-0 shadow-sm bg-info-subtle">
            <div class="card-body">
              <div
                class="d-flex align-items-center justify-content-center mb-2"
              >
                <i class="fas fa-swimmer text-info fs-4 me-2"></i>
                <h6 class="mb-0 text-info">Pool</h6>
              </div>
              <h4 class="text-info mb-0">150</h4>
              <small class="text-muted">lượt</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="row mb-4">
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-pie me-2"></i>Phân bổ theo loại dịch vụ
                tháng này
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 350px">
                <canvas id="serviceTypeChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-bar me-2"></i>Xu hướng theo giờ tháng này
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 350px">
                <canvas id="hourlyTrendChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Detailed List Table -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-list me-2"></i>Danh sách check-in Membership
                tháng này
              </h5>
            </div>
            <div class="card-body">
              <!-- Filter Section -->
              <div class="row mb-3">
                <div class="col">
                  <label class="form-label">Cơ sở</label>
                  <select class="form-select" id="locationFilter">
                    <option value="all">Tất cả cơ sở</option>
                    <option value="ton-that-thuyet">Tôn Thất Thuyết</option>
                    <option value="huynh-thuc-khang">Huỳnh Thúc Kháng</option>
                    <option value="giang-vo">Giảng Võ</option>
                    <option value="hao-nam">Hào Nam</option>
                    <option value="nguyen-tuan">Nguyễn Tuân</option>
                  </select>
                </div>
                <div class="col">
                  <label class="form-label">Loại dịch vụ</label>
                  <select class="form-select" id="serviceTypeFilter">
                    <option value="all">Tất cả dịch vụ</option>
                    <option value="gym">Gym</option>
                    <option value="yoga">Yoga</option>
                    <option value="group-x">Group X</option>
                    <option value="pool">Pool</option>
                  </select>
                </div>
                <div class="col">
                  <label class="form-label">Nhân viên chăm sóc</label>
                  <select class="form-select" id="staffFilter">
                    <option value="all">Tất cả NVCS</option>
                    <option value="nguyen-thi-e">Nguyễn Thị E</option>
                    <option value="tran-van-f">Trần Văn F</option>
                    <option value="le-thi-g">Lê Thị G</option>
                    <option value="pham-van-h">Phạm Văn H</option>
                  </select>
                </div>
                <div class="col">
                  <label class="form-label">Tìm kiếm</label>
                  <input
                    type="text"
                    class="form-control"
                    id="searchInput"
                    placeholder="Tìm theo tên hội viên..."
                  />
                </div>
                <div class="col d-flex align-items-end">
                  <button
                    class="btn me-2"
                    style="background-color: #e83e8c; color: white"
                    onclick="applyFilters()"
                  >
                    <i class="fas fa-filter me-1"></i>Lọc
                  </button>
                  <button
                    class="btn btn-outline-secondary"
                    onclick="resetFilters()"
                  >
                    <i class="fas fa-undo me-1"></i>Reset
                  </button>
                </div>
              </div>

              <!-- Table -->
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-light">
                    <tr>
                      <th>STT</th>
                      <th>Hội viên</th>
                      <th>Cơ sở</th>
                      <th>Loại dịch vụ</th>
                      <th>Nhân viên chăm sóc</th>
                      <th>Giờ check-in</th>
                    </tr>
                  </thead>
                  <tbody id="checkinTableBody">
                    <!-- Data will be loaded here -->
                  </tbody>
                </table>
              </div>

              <!-- Pagination -->
              <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center" id="pagination">
                  <!-- Pagination will be generated here -->
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/realtime-clock.js"></script>

    <script>
      // Generate sample data for Membership MTD check-ins (1,250 records total)
      function generateMembershipMTDData() {
        const data = [];
        const locations = [
          { name: "Tôn Thất Thuyết", key: "ton-that-thuyet" },
          { name: "Huỳnh Thúc Kháng", key: "huynh-thuc-khang" },
          { name: "Giảng Võ", key: "giang-vo" },
          { name: "Hào Nam", key: "hao-nam" },
          { name: "Nguyễn Tuân", key: "nguyen-tuan" },
        ];
        const serviceTypes = [
          { name: "Gym", key: "gym", count: 500 },
          { name: "Yoga", key: "yoga", count: 310 },
          { name: "Group X", key: "group-x", count: 290 },
          { name: "Pool", key: "pool", count: 150 },
        ];
        const staffMembers = [
          { name: "Nguyễn Thị E", key: "nguyen-thi-e" },
          { name: "Trần Văn F", key: "tran-van-f" },
          { name: "Lê Thị G", key: "le-thi-g" },
          { name: "Phạm Văn H", key: "pham-van-h" },
        ];
        const hours = [
          "06",
          "07",
          "08",
          "09",
          "10",
          "11",
          "12",
          "13",
          "14",
          "15",
          "16",
          "17",
          "18",
          "19",
          "20",
          "21",
        ];
        const minutes = [
          "00",
          "05",
          "10",
          "15",
          "20",
          "25",
          "30",
          "35",
          "40",
          "45",
          "50",
          "55",
        ];

        let recordId = 1;

        serviceTypes.forEach((service) => {
          for (let i = 0; i < service.count; i++) {
            const location =
              locations[Math.floor(rng.next() * locations.length)];
            const staff =
              staffMembers[Math.floor(rng.next() * staffMembers.length)];
            const hour = hours[Math.floor(rng.next() * hours.length)];
            const minute = minutes[Math.floor(rng.next() * minutes.length)];
            const day = Math.floor(rng.next() * 30) + 1;
            const dateStr = `2024-09-${String(day).padStart(2, "0")}`;

            data.push({
              id: `membership_mtd_${recordId}`,
              memberId: `HV${String(recordId).padStart(4, "0")}`,
              memberName: `Hội viên ${String(recordId).padStart(4, "0")}`,
              location: location.name,
              locationKey: location.key,
              serviceType: service.name,
              serviceTypeKey: service.key,
              staffInCharge: staff.name,
              staffKey: staff.key,
              checkinTime: `${hour}:${minute}`,
              createdAt: `${dateStr}T${hour}:${minute}:00Z`,
            });
            recordId++;
          }
        });

        return data;
      }

      // Generate the data
      const membershipMTDData = generateMembershipMTDData();

      // Pagination variables
      let currentPage = 1;
      const recordsPerPage = 20;
      let filteredData = [...membershipMTDData];

      // Filter functions
      function applyFilters() {
        const location = document.getElementById("locationFilter").value;
        const serviceType = document.getElementById("serviceTypeFilter").value;
        const staff = document.getElementById("staffFilter").value;
        const search = document
          .getElementById("searchInput")
          .value.toLowerCase();

        filteredData = membershipMTDData.filter((item) => {
          // Location filter
          if (location !== "all" && item.locationKey !== location) return false;

          // Service type filter
          if (serviceType !== "all" && item.serviceTypeKey !== serviceType)
            return false;

          // Staff filter
          if (staff !== "all" && item.staffKey !== staff) return false;

          // Search filter
          if (search && !item.memberName.toLowerCase().includes(search))
            return false;

          return true;
        });

        currentPage = 1;
        loadCheckinData();
      }

      function resetFilters() {
        document.getElementById("locationFilter").value = "all";
        document.getElementById("serviceTypeFilter").value = "all";
        document.getElementById("staffFilter").value = "all";
        document.getElementById("searchInput").value = "";

        filteredData = [...membershipMTDData];
        currentPage = 1;
        loadCheckinData();
      }

      function loadCheckinData(data = filteredData) {
        const tbody = document.getElementById("checkinTableBody");
        tbody.innerHTML = "";

        const startIndex = (currentPage - 1) * recordsPerPage;
        const endIndex = startIndex + recordsPerPage;
        const pageData = data.slice(startIndex, endIndex);

        pageData.forEach((item, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${startIndex + index + 1}</td>
            <td>
              <div class="d-flex align-items-center">
                <div class="avatar-sm text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="background-color: #e83e8c;">
                  ${item.memberName.charAt(0)}
                </div>
                <div>
                  <div class="fw-bold">${item.memberName}</div>
                  <small class="text-muted">${item.memberId}</small>
                </div>
              </div>
            </td>
            <td>${item.location}</td>
            <td>
              <span class="badge bg-${getServiceTypeBadgeClass(
                item.serviceTypeKey
              )}">
                ${item.serviceType}
              </span>
            </td>
            <td>
              <div class="d-flex align-items-center">
                <div class="avatar-sm bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-2">
                  ${item.staffInCharge.charAt(0)}
                </div>
                <span>${item.staffInCharge}</span>
              </div>
            </td>
            <td>${item.checkinTime}</td>
          `;
          tbody.appendChild(row);
        });

        generatePagination(data.length);
      }

      function getServiceTypeBadgeClass(serviceType) {
        const classes = {
          gym: "primary",
          yoga: "success",
          "group-x": "warning",
          pool: "info",
        };
        return classes[serviceType] || "secondary";
      }

      // Generate pagination
      function generatePagination(totalRecords) {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        const totalPages = Math.ceil(totalRecords / recordsPerPage);

        if (totalPages <= 1) return;

        // Previous button
        const prevLi = document.createElement("li");
        prevLi.className = `page-item ${currentPage === 1 ? "disabled" : ""}`;
        prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${
          currentPage - 1
        })">Trước</a>`;
        pagination.appendChild(prevLi);

        // Smart pagination with ellipsis
        const maxVisiblePages = 7; // Show max 7 page numbers
        let startPage, endPage;

        if (totalPages <= maxVisiblePages) {
          // Show all pages if total is small
          startPage = 1;
          endPage = totalPages;
        } else {
          // Calculate start and end pages
          const halfVisible = Math.floor(maxVisiblePages / 2);

          if (currentPage <= halfVisible) {
            startPage = 1;
            endPage = maxVisiblePages;
          } else if (currentPage + halfVisible >= totalPages) {
            startPage = totalPages - maxVisiblePages + 1;
            endPage = totalPages;
          } else {
            startPage = currentPage - halfVisible;
            endPage = currentPage + halfVisible;
          }
        }

        // First page
        if (startPage > 1) {
          const firstLi = document.createElement("li");
          firstLi.className = "page-item";
          firstLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(1)">1</a>`;
          pagination.appendChild(firstLi);

          // Add ellipsis if needed
          if (startPage > 2) {
            const ellipsisLi = document.createElement("li");
            ellipsisLi.className = "page-item disabled";
            ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
            pagination.appendChild(ellipsisLi);
          }
        }

        // Page numbers
        for (let i = startPage; i <= endPage; i++) {
          const li = document.createElement("li");
          li.className = `page-item ${i === currentPage ? "active" : ""}`;
          li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
          pagination.appendChild(li);
        }

        // Last page
        if (endPage < totalPages) {
          // Add ellipsis if needed
          if (endPage < totalPages - 1) {
            const ellipsisLi = document.createElement("li");
            ellipsisLi.className = "page-item disabled";
            ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
            pagination.appendChild(ellipsisLi);
          }

          const lastLi = document.createElement("li");
          lastLi.className = "page-item";
          lastLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${totalPages})">${totalPages}</a>`;
          pagination.appendChild(lastLi);
        }

        // Next button
        const nextLi = document.createElement("li");
        nextLi.className = `page-item ${
          currentPage === totalPages ? "disabled" : ""
        }`;
        nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${
          currentPage + 1
        })">Tiếp</a>`;
        pagination.appendChild(nextLi);
      }

      // Change page
      function changePage(page) {
        if (page < 1 || page > Math.ceil(filteredData.length / recordsPerPage))
          return;
        currentPage = page;
        loadCheckinData();
      }

      // Chart creation
      function createCharts() {
        // Service Type Chart
        const serviceTypeCtx = document.getElementById("serviceTypeChart");
        if (serviceTypeCtx) {
          new Chart(serviceTypeCtx, {
            type: "doughnut",
            data: {
              labels: ["Gym", "Yoga", "Group X", "Pool"],
              datasets: [
                {
                  data: [500, 310, 290, 150],
                  backgroundColor: ["#007bff", "#28a745", "#ffc107", "#17a2b8"],
                  borderWidth: 2,
                  borderColor: "#fff",
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "right",
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      const total = context.dataset.data.reduce(
                        (a, b) => a + b,
                        0
                      );
                      const percentage = (
                        (context.parsed / total) *
                        100
                      ).toFixed(1);
                      return `${context.label}: ${context.parsed} (${percentage}%)`;
                    },
                  },
                },
              },
            },
          });
        }

        // Hourly Trend Chart
        const hourlyCtx = document.getElementById("hourlyTrendChart");
        if (hourlyCtx) {
          new Chart(hourlyCtx, {
            type: "bar",
            data: {
              labels: [
                "5h30-8h",
                "8h-10h",
                "10h-12h",
                "12h-14h",
                "14h-16h",
                "16h-18h",
                "18h-20h",
                "20h-22h",
              ],
              datasets: [
                {
                  label: "Số lượt check-in",
                  data: [68, 85, 78, 65, 72, 95, 125, 98],
                  backgroundColor: "#e83e8c",
                  borderColor: "#c2185b",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
        }
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        console.log("Membership MTD page loaded");
        loadCheckinData();
        createCharts();
      });
    </script>

    <!-- SPA System -->
    <script src="../assets/js/spa/store.js"></script>
    <script src="../assets/js/spa/components.js"></script>
    <script src="../assets/js/spa/router.js"></script>
    <script src="../assets/js/spa/integration.js"></script>
  
    <script>
      // Seeded Random Number Generator for Consistent Data
      class SeededRandom {
        constructor(seed = 12345) {
          this.seed = seed;
        }

        next() {
          this.seed = (this.seed * 9301 + 49297) % 233280;
          return this.seed / 233280;
        }

        nextInt(min, max) {
          return Math.floor(this.next() * (max - min + 1)) + min;
        }

        nextFloat(min, max, decimals = 2) {
          return parseFloat((this.next() * (max - min) + min).toFixed(decimals));
        }

        choice(array) {
          return array[this.nextInt(0, array.length - 1)];
        }
      }

      // Initialize seeded random generator
      const rng = new SeededRandom(12345);
    </script>
  
</body>
</html>
